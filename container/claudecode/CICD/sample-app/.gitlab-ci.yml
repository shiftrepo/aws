# MavenåŸºæœ¬ãƒ†ã‚¹ãƒˆ - æ®µéšçš„æ¤œè¨¼
variables:
  MAVEN_OPTS: "-Dmaven.repo.local=./.m2/repository"

before_script:
  - echo "ğŸ”§ Mavenè¨­å®šã‚’æº–å‚™ä¸­..."
  - mkdir -p ./.m2
  - |
    cat > ./.m2/settings.xml << EOF
    <?xml version="1.0" encoding="UTF-8"?>
    <settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
              http://maven.apache.org/xsd/settings-1.0.0.xsd">
      <mirrors>
        <mirror>
          <id>nexus-mirror</id>
          <mirrorOf>*</mirrorOf>
          <url>http://${EC2_PUBLIC_IP:-localhost}:8082/repository/maven-public/</url>
        </mirror>
      </mirrors>
    </settings>
    EOF
  - echo "âœ… Mavenè¨­å®šå®Œäº†"

stages:
  - maven_test

maven_basic_test:
  stage: maven_test
  script:
    - echo "ğŸ“‹ ç’°å¢ƒç¢ºèª"
    - mvn --version
    - java -version
    - echo "ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ç¢ºèª"
    - ls -la
    - cat pom.xml | head -20
    - echo "ğŸ—ï¸ MavenåŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ"
    - mvn -B -V -s ./.m2/settings.xml validate
    - echo "âœ… MavenåŸºæœ¬ãƒ†ã‚¹ãƒˆæˆåŠŸ"
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH