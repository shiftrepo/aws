# CICDå®Œå…¨ç’°å¢ƒæ§‹ç¯‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã«æº–æ‹ ã—ãŸã€å®Œå…¨ãªCI/CDç’°å¢ƒã¨ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚GitLabã€Nexusã€SonarQubeã€PostgreSQLã‚’ä½¿ç”¨ã—ãŸæœ¬æ ¼çš„ãªé–‹ç™ºç’°å¢ƒã‚’ã€ã‚¹ã‚¯ãƒ©ãƒƒãƒãƒ“ãƒ«ãƒ‰ã‹ã‚‰å®Œå…¨å¾©å…ƒã¾ã§å¯¾å¿œã—ã¾ã™ã€‚

[![Pipeline Status](http://${EC2_PUBLIC_IP}:5003/root/sample-app/badges/master/pipeline.svg)](http://${EC2_PUBLIC_IP}:5003/root/sample-app/-/commits/master)
[![Quality Gate](http://${EC2_PUBLIC_IP}:8000/api/project_badges/measure?project=sample-app-backend&metric=alert_status)](http://${EC2_PUBLIC_IP}:8000/dashboard?id=sample-app-backend)
[![Coverage](http://${EC2_PUBLIC_IP}:8000/api/project_badges/measure?project=sample-app-backend&metric=coverage)](http://${EC2_PUBLIC_IP}:8000/dashboard?id=sample-app-backend)

## ğŸ“‹ ç›®æ¬¡

- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
- [ä¸»ãªæ©Ÿèƒ½](#ä¸»ãªæ©Ÿèƒ½)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [åˆå›ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±](#åˆå›ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±)
- [ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³](#ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)
- [CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#cicdãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
- [é‹ç”¨ç®¡ç†](#é‹ç”¨ç®¡ç†)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)

---

## ğŸŒŸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä»¥ä¸‹ã‚’æä¾›ã—ã¾ã™ï¼š

1. **å®Œå…¨ãªCI/CDç’°å¢ƒ** - GitLabã€Nexusã€SonarQubeã€PostgreSQLã®çµ±åˆç’°å¢ƒ
2. **ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³** - Spring Boot + Reactã«ã‚ˆã‚‹çµ„ç¹”ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCRUDæ©Ÿèƒ½ï¼‰
3. **è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** - ãƒ“ãƒ«ãƒ‰ â†’ ãƒ†ã‚¹ãƒˆ â†’ ã‚«ãƒãƒ¬ãƒƒã‚¸ â†’ é™çš„è§£æ â†’ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤
4. **å“è³ªä¿è¨¼åŸºç›¤** - 80%ã‚«ãƒãƒ¬ãƒƒã‚¸ã€SonarQubeå“è³ªã‚²ãƒ¼ãƒˆ
5. **é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ** - ã‚¼ãƒ­ã‹ã‚‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€å¾©å…ƒã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
6. **ã‚¹ã‚¯ãƒ©ãƒƒãƒãƒ“ãƒ«ãƒ‰å¯¾å¿œ** - å®Œå…¨ãªç’°å¢ƒå†æ§‹ç¯‰ãŒå¯èƒ½

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
/root/aws.git/container/claudecode/CICD/
â”œâ”€â”€ docker-compose.yml              # å…¨ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆå®šç¾©
â”œâ”€â”€ .env                            # ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å«ã‚€ã€Gité™¤å¤–ï¼‰
â”œâ”€â”€ .gitignore                      # Gité™¤å¤–è¨­å®šï¼ˆcredentials.txtã€.env.backup.*å«ã‚€ï¼‰
â”œâ”€â”€ README.md                       # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ CREDENTIALS.md                  # èªè¨¼æƒ…å ±ç®¡ç†ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ QUICKSTART.md                   # ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰
â”‚
â”œâ”€â”€ config/                         # ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ gitlab/
â”‚   â”œâ”€â”€ nexus/
â”‚   â”œâ”€â”€ sonarqube/
â”‚   â”œâ”€â”€ postgres/
â”‚   â”œâ”€â”€ pgadmin/
â”‚   â”œâ”€â”€ gitlab-runner/
â”‚   â””â”€â”€ maven/
â”‚
â”œâ”€â”€ volumes/                        # æ°¸ç¶šåŒ–ãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼ˆ.gitignoreï¼‰
â”‚   â”œâ”€â”€ gitlab-config/
â”‚   â”œâ”€â”€ gitlab-logs/
â”‚   â”œâ”€â”€ gitlab-data/
â”‚   â”œâ”€â”€ nexus-data/
â”‚   â”œâ”€â”€ sonarqube-data/
â”‚   â”œâ”€â”€ postgres-data/
â”‚   â””â”€â”€ pgadmin-data/
â”‚
â”œâ”€â”€ scripts/                        # é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ setup-from-scratch.sh      # ã‚¼ãƒ­ã‹ã‚‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã€EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å…¥åŠ›ã€ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒï¼‰
â”‚   â”œâ”€â”€ show-credentials.sh        # å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼æƒ…å ±è¡¨ç¤ºãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
â”‚   â”œâ”€â”€ update-passwords.sh        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ãƒ»EC2ãƒ›ã‚¹ãƒˆæ›´æ–°
â”‚   â”œâ”€â”€ backup-all.sh              # å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ restore-all.sh             # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
â”‚   â”œâ”€â”€ cleanup-all.sh             # å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
â”‚   â””â”€â”€ deploy-oneclick.sh         # ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å†ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚
â””â”€â”€ sample-app/                     # ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    â”œâ”€â”€ pom.xml                     # è¦ªPOMï¼ˆãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
    â”œâ”€â”€ .gitlab-ci.yml              # CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®šç¾©
    â”œâ”€â”€ .ci-settings.xml.template   # Mavenè¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â”‚
    â”œâ”€â”€ common/                     # å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆDTOï¼‰
    â”‚   â”œâ”€â”€ pom.xml
    â”‚   â””â”€â”€ src/main/java/com/example/common/dto/
    â”‚
    â”œâ”€â”€ backend/                    # Spring Bootãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
    â”‚   â”œâ”€â”€ pom.xml
    â”‚   â””â”€â”€ src/
    â”‚       â”œâ”€â”€ main/
    â”‚       â”‚   â”œâ”€â”€ java/com/example/backend/
    â”‚       â”‚   â”‚   â”œâ”€â”€ entity/          # JPAã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
    â”‚       â”‚   â”‚   â”œâ”€â”€ repository/      # Spring Data JPA
    â”‚       â”‚   â”‚   â”œâ”€â”€ service/         # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    â”‚       â”‚   â”‚   â””â”€â”€ controller/      # REST API
    â”‚       â”‚   â””â”€â”€ resources/
    â”‚       â”‚       â”œâ”€â”€ application.yml
    â”‚       â”‚       â””â”€â”€ db/migration/    # Flyway SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    â”‚       â””â”€â”€ test/                    # JUnit 5ãƒ†ã‚¹ãƒˆ
    â”‚
    â””â”€â”€ frontend/                   # Reactãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
        â”œâ”€â”€ package.json
        â”œâ”€â”€ vite.config.js
        â””â”€â”€ src/
            â”œâ”€â”€ components/
            â”œâ”€â”€ pages/
            â””â”€â”€ api/
```

---

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### CI/CDç’°å¢ƒ

- **GitLab CE**: Git ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†ã€CI/CDã€ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã€Mattermost
- **Nexus Repository**: Maven/npm/Dockerã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç†
- **SonarQube**: é™çš„ã‚³ãƒ¼ãƒ‰è§£æã€å“è³ªã‚²ãƒ¼ãƒˆã€æŠ€è¡“çš„è² å‚µç®¡ç†
- **PostgreSQL 16**: çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆGitLabã€SonarQubeã€sample-appï¼‰
- **pgAdmin 4**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹GUIç®¡ç†ãƒ„ãƒ¼ãƒ«
- **GitLab Runner**: Shell executor ã«ã‚ˆã‚‹CI/CDå®Ÿè¡Œ

### ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆçµ„ç¹”ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼‰

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Spring Boot 3.2 + Java 17 + Maven
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React + Vite
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL + Flyway ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **ãƒ†ã‚¹ãƒˆ**: JUnit 5 + Mockito + JaCoCoï¼ˆ80%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆï¼‰
- **æ©Ÿèƒ½**: çµ„ç¹”ãƒ»éƒ¨ç½²ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®CRUDæ“ä½œã€éšå±¤ç®¡ç†

### é‹ç”¨æ©Ÿèƒ½

- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†**: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹ä¸€å…ƒç®¡ç†ã€å¯¾è©±çš„è¨­å®š
- **å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: è¨­å®šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒªãƒã‚¸ãƒˆãƒªã®ä¸€æ‹¬ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- **ã‚¹ã‚¯ãƒ©ãƒƒãƒãƒ“ãƒ«ãƒ‰**: ã‚¼ãƒ­ã‹ã‚‰ã®å®Œå…¨ç’°å¢ƒå†æ§‹ç¯‰
- **ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— â†’ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— â†’ å†æ§‹ç¯‰ã®è‡ªå‹•åŒ–

---

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒï¼ˆæ¤œè¨¼æ¸ˆã¿æ§‹æˆï¼‰

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | å³å¯†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‚™è€ƒ |
|---------|------|-------------|------|
| OS | Red Hat Enterprise Linux | **9.7** | RHEL 9.7 (Plow) |
| ã‚³ãƒ³ãƒ†ãƒŠ | Podman | **5.6.0** | Dockeräº’æ›ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  |
| ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | Docker Compose | **v3.8** | Podman Compose |
| Java Runtime | OpenJDK | **17.0.17 LTS** | Red Hat build |
| ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« | Apache Maven | **3.6.3** | Red Hat 3.6.3-22 |

### CI/CDã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚³ãƒ³ãƒ†ãƒŠï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | ã‚¤ãƒ¡ãƒ¼ã‚¸ | å³å¯†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|---------|---------|-------------|------|
| **GitLab CE** | `gitlab/gitlab-ce` | **latest** | Gitã€CI/CDã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒª |
| **GitLab Runner** | `gitlab/gitlab-runner` | **latest** | CI/CDå®Ÿè¡Œï¼ˆShell executorï¼‰ |
| **Nexus Repository** | `sonatype/nexus3` | **latest** | Maven/npm/Docker ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç† |
| **SonarQube** | `sonarqube` | **10-community** | é™çš„ã‚³ãƒ¼ãƒ‰è§£æ |
| **PostgreSQL** | `postgres` | **16-alpine** | çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| **pgAdmin** | `dpage/pgadmin4` | **latest** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹GUI |

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | å³å¯†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | è¨­å®šç®‡æ‰€ |
|---------|------|-------------|---------|
| **Java** | OpenJDK | **17.0.17 LTS** | `maven.compiler.source/target` |
| **Spring Boot** | Spring Boot Starter Parent | **3.2.1** | è¦ªPOM `spring-boot.version` |
| **ORM** | Spring Data JPA + Hibernate | **3.2.1ç³»** | Spring Bootä¾å­˜ |
| **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** | Flyway | **9.xç³»** | Spring Bootä¾å­˜ |
| **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** | Lombok | **1.18.30** | è¦ªPOM `lombok.version` |

### ãƒ†ã‚¹ãƒˆãƒ»å“è³ªç®¡ç†

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | å³å¯†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | è¨­å®šç®‡æ‰€ |
|---------|------|-------------|---------|
| **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** | JUnit | **5.10.1** | è¦ªPOM `junit.version` |
| **ãƒ¢ãƒƒã‚­ãƒ³ã‚°** | Mockito | **5.8.0** | è¦ªPOM `mockito.version` |
| **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³** | AssertJ | **3.25.1** | è¦ªPOM `assertj.version` |
| **ã‚«ãƒãƒ¬ãƒƒã‚¸** | JaCoCo Maven Plugin | **0.8.11** | è¦ªPOM `jacoco.version` |
| **SonarQube Scanner** | SonarQube Maven Plugin | **3.10.0.2594** | è¦ªPOM `sonar.version` |

### å“è³ªã‚²ãƒ¼ãƒˆåŸºæº–

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | è¨­å®šå€¤ | è¨­å®šç®‡æ‰€ |
|----------|--------|---------|
| **è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸** | **â‰¥ 80%** | è¦ªPOM `jacoco.line.coverage` |
| **ãƒ–ãƒ©ãƒ³ãƒã‚«ãƒãƒ¬ãƒƒã‚¸** | **â‰¥ 70%** | è¦ªPOM `jacoco.branch.coverage` |
| **SonarQubeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼** | `sample-app` | è¦ªPOM `sonar.projectKey` |
| **SonarQube URL** | `http://localhost:8000` | è¦ªPOM `sonar.host.url` |

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆ

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒãƒ¼ãƒˆ | ç”¨é€” | ä¾å­˜é–¢ä¿‚ |
|---------|-------|------|---------|
| **PostgreSQL** | 5001 | çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | - |
| **pgAdmin** | 5002 | DB GUIç®¡ç† | PostgreSQL |
| **GitLab CE** | 5003 (HTTP)<br>5005 (SSH)<br>5004 (Mattermost) | Gitã€CI/CDã€ãƒãƒ£ãƒƒãƒˆ | PostgreSQL |
| **GitLab Runner** | - | CI/CDå®Ÿè¡Œ | GitLab |
| **Nexus** | 8082 (UI/Maven)<br>8083 (Docker) | ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç®¡ç† | - |
| **SonarQube** | 8000 | é™çš„è§£æ | PostgreSQL |
| **Backend API** | 8501 | REST API | PostgreSQL |
| **Frontend** | 3000 | React UI | Backend API |

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    cicd-network (bridge)                 â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ GitLab   â”‚  â”‚  Nexus   â”‚  â”‚SonarQube â”‚              â”‚
â”‚  â”‚ :5003    â”‚  â”‚  :8082   â”‚  â”‚  :8000   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â”‚       â”‚                            â”‚                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                 â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚   PostgreSQL   â”‚     â”‚ pgAdmin  â”‚             â”‚
â”‚         â”‚     :5001      â”‚â—„â”€â”€â”€â”€â”¤  :5002   â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                 â–²                                        â”‚
â”‚                 â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚         â”‚  Sample App    â”‚                               â”‚
â”‚         â”‚  Backend:8501  â”‚                               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆsample-appï¼‰

```sql
-- çµ„ç¹”ãƒ†ãƒ¼ãƒ–ãƒ«
organizations (
    id BIGSERIAL PRIMARY KEY,
    code VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    established_date DATE,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)

-- éƒ¨ç½²ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆéšå±¤æ§‹é€ å¯¾å¿œï¼‰
departments (
    id BIGSERIAL PRIMARY KEY,
    organization_id BIGINT â†’ organizations(id),
    code VARCHAR(50) NOT NULL,
    name VARCHAR(200) NOT NULL,
    parent_department_id BIGINT â†’ departments(id),
    description TEXT,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    UNIQUE (organization_id, code)
)

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
users (
    id BIGSERIAL PRIMARY KEY,
    department_id BIGINT â†’ departments(id),
    employee_number VARCHAR(50) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(200) UNIQUE NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(50),
    position VARCHAR(100),
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)
```

---

## ğŸ“‹ å‰ææ¡ä»¶

### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- **OS**: RHEL 9 / Amazon Linux 2023 / CentOS Stream 9
- **ãƒ¡ãƒ¢ãƒª**: æœ€ä½ 8GBã€æ¨å¥¨ 16GB
- **ãƒ‡ã‚£ã‚¹ã‚¯**: æœ€ä½ 20GBã€æ¨å¥¨ 50GB
- **CPU**: æœ€ä½ 2ã‚³ã‚¢ã€æ¨å¥¨ 4ã‚³ã‚¢

### å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

```bash
# RHEL 9 / Amazon Linux 2023
sudo yum install -y \
  git \
  podman \
  podman-compose \
  maven \
  java-17-openjdk-devel \
  python3 \
  curl \
  wget
```

### ãã®ä»–

- **å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã§ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆã‚’é–‹æ”¾
  - 5003 (GitLab HTTP)
  - 5005 (GitLab SSH)
  - 8082 (Nexus)
  - 8000 (SonarQube)
  - 5002 (pgAdmin)

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ–¹æ³•ä¸€è¦§

ã™ã¹ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯`scripts/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿè¡Œå‰ã«å¿…ãšå®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚

```bash
# å®Ÿè¡Œæ¨©é™ã®ä»˜ä¸ï¼ˆåˆå›ã®ã¿ï¼‰
cd /root/aws.git/container/claudecode/CICD
chmod +x scripts/*.sh
```

#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ¨©é™ä¸€è¦§è¡¨

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆå | å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ | å¿…é ˆæ¨©é™ | ç”¨é€” |
|------------|------------|---------|------|
| `setup-from-scratch.sh` | `sudo ./scripts/setup-from-scratch.sh` | **sudoå¿…é ˆ** | åˆå›ç’°å¢ƒæ§‹ç¯‰ï¼ˆ12ã‚¹ãƒ†ãƒƒãƒ—ï¼‰ |
| `show-credentials.sh` | `./scripts/show-credentials.sh` | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ | èªè¨¼æƒ…å ±è¡¨ç¤º |
| `update-passwords.sh` | `./scripts/update-passwords.sh [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]` | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰/ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–° |
| `backup-all.sh` | `sudo ./scripts/backup-all.sh` | **sudoå¿…é ˆ** | å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |
| `restore-all.sh` | `sudo ./scripts/restore-all.sh <backup-dir>` | **sudoå¿…é ˆ** | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ |
| `cleanup-all.sh` | `sudo ./scripts/cleanup-all.sh` | **sudoå¿…é ˆ** | å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤ |
| `deploy-oneclick.sh` | `sudo ./scripts/deploy-oneclick.sh` | **sudoå¿…é ˆ** | ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å†ãƒ‡ãƒ—ãƒ­ã‚¤ |
| `setup-cicd.sh` | `sudo ./scripts/setup-cicd.sh` | **sudoå¿…é ˆ** | CI/CDç’°å¢ƒè‡ªå‹•æ§‹ç¯‰ |
| `setup-sample-app.sh` | `./scripts/setup-sample-app.sh` | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ | CI/CDæ¤œè¨¼ï¼ˆæ¨å¥¨ï¼‰ |
| `setup-gitlab-variables.sh` | `./scripts/setup-gitlab-variables.sh` | é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ | GitLabç’°å¢ƒå¤‰æ•°è¨­å®šã‚¬ã‚¤ãƒ‰ |

**é‡è¦ãªæ³¨æ„äº‹é …:**
- **sudo ãŒå¿…è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: ã‚³ãƒ³ãƒ†ãƒŠæ“ä½œã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´ã‚’è¡Œã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: è¨­å®šç¢ºèªã€ç’°å¢ƒå¤‰æ•°æ›´æ–°ã€GitLabæ“ä½œã‚’è¡Œã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `setup-sample-app.sh`ã¯é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®å®Ÿè¡Œã‚’æ¨å¥¨ã—ã¾ã™ãŒã€ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ sudo ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™

### 1. ã‚¼ãƒ­ã‹ã‚‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆã¾ãŸã¯æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ï¼‰
cd /root/aws.git/container/claudecode/CICD

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ï¼ˆåˆå›ã®ã¿ï¼‰
chmod +x scripts/*.sh

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Ÿè¡Œï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/setup-from-scratch.sh
```

**ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…å®¹ï¼ˆ12ã‚¹ãƒ†ãƒƒãƒ—ï¼‰**:
1. ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. SELinuxè¨­å®šã®èª¿æ•´
3. Podmanã‚½ã‚±ãƒƒãƒˆã®æœ‰åŠ¹åŒ–
4. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ
5. **ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š**ï¼ˆå¯¾è©±çš„å…¥åŠ›ã€ç¢ºèªå…¥åŠ›ã§èª¤å…¥åŠ›é˜²æ­¢ï¼‰
6. **EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¨­å®š**ï¼ˆå¯¾è©±çš„å…¥åŠ›ã€è‡ªå‹•æ¤œå‡ºå¯¾å¿œï¼‰
7. ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.envï¼‰ã®ç”Ÿæˆãƒ»æ›´æ–°ï¼ˆæ—¢å­˜ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•ä¿æŒï¼‰
8. Docker Composeè¨­å®šã®ç¢ºèª
9. ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
10. GitLab Runnerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
11. Mavenè¨­å®šã®é…ç½®ï¼ˆEC2ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å‹•çš„ç½®æ›ï¼‰
12. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ãƒã‚§ãƒƒã‚¯

**é‡è¦ãªæ©Ÿèƒ½**:
- **ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒ**: æ—¢å­˜ã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€SONAR_TOKEN ã¨ RUNNER_TOKEN ã‚’è‡ªå‹•ä¿æŒ
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ**: .env æ›´æ–°æ™‚ã€è‡ªå‹•çš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆ.env.backup.YYYYMMDDHHMMSSï¼‰ã‚’ä½œæˆ
- **EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ**: å…¥åŠ›ãªã—ã®å ´åˆã€EC2ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰è‡ªå‹•æ¤œå‡ºï¼ˆ169.254.169.254ï¼‰

### 2. ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª

```bash
# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ç¢ºèª
podman ps

# ã‚µãƒ¼ãƒ“ã‚¹æ¥ç¶šç¢ºèª
curl http://localhost:5003/  # GitLab
curl http://localhost:8082/  # Nexus
curl http://localhost:8000/  # SonarQube
curl http://localhost:5002/  # pgAdmin

# PostgreSQLæ¥ç¶šç¢ºèª
psql -h localhost -p 5001 -U cicduser -d cicddb
```

### 3. GitLab Runnerã®ç™»éŒ²

```bash
# GitLabã®Settings â†’ CI/CD â†’ Runnersã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
sudo gitlab-runner register \
  --url http://${EC2_PUBLIC_IP}:5003 \
  --token YOUR_REGISTRATION_TOKEN \
  --executor shell \
  --description "CICD Shell Runner"

# Runnerã®èµ·å‹•
sudo systemctl enable --now gitlab-runner
sudo systemctl status gitlab-runner
```

### 4. CI/CDç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆè‡ªå‹•åŒ–ï¼‰

**å‰ææ¡ä»¶**: ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•å®Œäº†ã€åŸºæœ¬ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šå®Œäº†

```bash
# CI/CDç’°å¢ƒã®å®Œå…¨è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/setup-cicd.sh
```

**ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…å®¹ï¼ˆ6ã‚¹ãƒ†ãƒƒãƒ—ï¼‰**:
1. **èªè¨¼æƒ…å ±ã®ç¢ºèª** - Nexusãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç–é€šç¢ºèªã€SonarQubeãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•ç”Ÿæˆ
2. **GitLab Runnerç™»éŒ²** - Registration Tokenè‡ªå‹•ç”Ÿæˆãƒ»ç™»éŒ²ãƒ»èµ·å‹•
3. **GitLabãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ** - Personal Access Tokenè‡ªå‹•ç”Ÿæˆãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
4. **CI/CDç’°å¢ƒå¤‰æ•°è¨­å®š** - SONAR_TOKENã€NEXUS_ADMIN_PASSWORDç­‰ã‚’è‡ªå‹•è¨­å®š
5. **sample-appãƒ—ãƒƒã‚·ãƒ¥** - SSHéµè‡ªå‹•ç”Ÿæˆãƒ»ç™»éŒ²ã€èªè¨¼ãªã—ãƒ—ãƒƒã‚·ãƒ¥
6. **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ç¢ºèª** - RunnerçŠ¶æ…‹ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡ŒçŠ¶æ³ç¢ºèª

**äº‹å‰æº–å‚™ãŒå¿…è¦ãªé …ç›®**:
- **Nexusãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**: admin/admin123 â†’ admin/Degital2026! (äº‹å‰å®Ÿæ–½)
- **SonarQubeãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**: admin/admin â†’ admin/Degital2026! (äº‹å‰å®Ÿæ–½)

**å®Œå…¨è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³**:
- SonarQubeãƒˆãƒ¼ã‚¯ãƒ³ (SonarQube APIçµŒç”±)
- GitLab Personal Access Token (GitLab Rails ConsoleçµŒç”±)
- GitLab Runner Registration Token (GitLab Rails ConsoleçµŒç”±)
- SSHéµãƒšã‚¢ (Ed25519è‡ªå‹•ç”Ÿæˆãƒ»GitLabç™»éŒ²)

### 5. CI/CDç’°å¢ƒã®æ¤œè¨¼ï¼ˆè‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã€CI/CDç’°å¢ƒãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¾ã™ï¼š

```bash
# CI/CDæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰
cd /root/aws.git/container/claudecode/CICD
./scripts/setup-sample-app.sh
```

**ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ©Ÿèƒ½ï¼ˆv2.1.0å¯¾å¿œï¼‰**:
- âœ… **è¤‡æ•°å›å®Ÿè¡Œå¯¾å¿œ**: ä½•åº¦å®Ÿè¡Œã—ã¦ã‚‚å®‰å…¨
- âœ… **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å®Œå…¨å‰Šé™¤
- âœ… **Gitç«¶åˆè‡ªå‹•è§£æ±º**: `--allow-unrelated-histories`ã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒ¼ã‚¸
- âœ… **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç›£è¦–**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤ºï¼ˆæœ€å¤§3åˆ†ï¼‰
- âœ… **ç‹¬ç«‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: `/tmp/gitlab-sample-app`ã§ãƒ¦ãƒ¼ã‚¶ãƒªãƒã‚¸ãƒˆãƒªã¨å®Œå…¨åˆ†é›¢

**å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ8ã‚¹ãƒ†ãƒƒãƒ—ï¼‰**:
1. **ç‹¬ç«‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ** - å®Ÿè¡ŒIDä»˜ãã§ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒæº–å‚™
2. **sample-appãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼** - ãƒ¦ãƒ¼ã‚¶ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ç‹¬ç«‹ã‚³ãƒ”ãƒ¼
3. **Gitãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–** - æ–°è¦Gitç’°å¢ƒä½œæˆ
4. **åˆæœŸã‚³ãƒŸãƒƒãƒˆä½œæˆ** - å®Ÿè¡ŒIDä»˜ãã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
5. **GitLabãƒªãƒ¢ãƒ¼ãƒˆè¨­å®š** - æ—¢å­˜ãƒªãƒ¢ãƒ¼ãƒˆå‰Šé™¤å¾Œã®å®‰å…¨ãªå†è¨­å®š
6. **GitLabãƒ—ãƒƒã‚·ãƒ¥ï¼ˆç«¶åˆè‡ªå‹•è§£æ±ºï¼‰** - è‡ªå‹•ãƒãƒ¼ã‚¸æ©Ÿèƒ½ä»˜ã
7. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹ç¢ºèª** - GitLab Runnerå‹•ä½œç¢ºèª
8. **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡ŒçŠ¶æ³ç›£è¦–** - å…¨5ã‚¹ãƒ†ãƒ¼ã‚¸æˆåŠŸã®è‡ªå‹•ç¢ºèª

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç›£è¦–å‡ºåŠ›ä¾‹**:
```
ğŸ”„ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­... (1/5 ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†)
ğŸ”„ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­... (3/5 ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†)
âœ… CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ã‚¹ãƒ†ãƒ¼ã‚¸æˆåŠŸï¼ˆ5å€‹ã®ã‚¸ãƒ§ãƒ–å®Œäº†ï¼‰
```

**æ¤œè¨¼å†…å®¹**:
- **GitLab**: ãƒªãƒã‚¸ãƒˆãƒªä½œæˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ãƒ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ
- **Maven**: ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°
- **JaCoCo**: ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆ80%ä»¥ä¸Šï¼‰
- **Nexus**: ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmaven-snapshotsï¼‰
- **GitLab Runner**: Shell executor ã§ã®è‡ªå‹•å®Ÿè¡Œ

### 6. æ‰‹å‹•ã§ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

CI/CDæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ãªã„å ´åˆã®æ‰‹å‹•æ‰‹é †ï¼š

```bash
cd sample-app

# ãƒªãƒ¢ãƒ¼ãƒˆURLã®è¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰
git remote set-url origin http://${EC2_PUBLIC_IP}:5003/root/sample-app.git

# ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³èµ·å‹•
git push -u origin master
```

---

## ğŸ”‘ åˆå›ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã‚’è€ƒæ…®ã—ã€**ã™ã¹ã¦ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç’°å¢ƒå¤‰æ•°ã§ä¸€å…ƒç®¡ç†**ã—ã¦ã„ã¾ã™ã€‚

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šæ–¹æ³•

1. **åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚**:
   - `setup-from-scratch.sh` å®Ÿè¡Œæ™‚ã«å¯¾è©±çš„ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
   - æœ€ä½8æ–‡å­—ã€è‹±æ•°å­—è¨˜å·ã‚’æ¨å¥¨
   - ç¢ºèªå…¥åŠ›ã§èª¤å…¥åŠ›ã‚’é˜²æ­¢

2. **æ—¢å­˜ç’°å¢ƒã®å ´åˆ**:
   - `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç·¨é›†
   ```bash
   vi .env

   # ä»¥ä¸‹ã®å¤‰æ•°ã‚’å¤‰æ›´
   GITLAB_ROOT_PASSWORD=your_password
   NEXUS_ADMIN_PASSWORD=your_password
   SONARQUBE_ADMIN_PASSWORD=your_password
   ```

3. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ä½¿ç”¨**:
   - GitLab CI/CDç’°å¢ƒå¤‰æ•°ã« `NEXUS_ADMIN_PASSWORD` ã‚’è¨­å®š
   - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚ã«è‡ªå‹•çš„ã« `.ci-settings.xml.template` ã‹ã‚‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ

### ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±

#### 1. GitLab
```
URL: http://${EC2_PUBLIC_IP}:5003
ãƒ¦ãƒ¼ã‚¶ãƒ¼å: root
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${GITLAB_ROOT_PASSWORD} (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Degital2026!)
```

#### 2. Nexus Repository
```
URL: http://${EC2_PUBLIC_IP}:8082
ãƒ¦ãƒ¼ã‚¶ãƒ¼å: admin
åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: admin123 (å›ºå®š)
```
- **åˆå›ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®å¯¾å¿œ**:
  - **å¿…é ˆ**: åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™
  - æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šï¼ˆæ¨å¥¨: Degital2026!ï¼‰
  - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã«å¾“ã£ã¦åˆæœŸè¨­å®šã‚’å®Œäº†
  - **é‡è¦**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¾Œã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `NEXUS_ADMIN_PASSWORD` ã‚’æ›´æ–°:
    ```bash
    ./scripts/update-passwords.sh --nexus æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
    ```

#### 3. SonarQube
```
URL: http://${EC2_PUBLIC_IP}:8000
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: admin / admin
```
- **åˆå›ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®å¯¾å¿œ**:
  - å¿…ãšãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™
  - æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸã‚‰ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã® `SONARQUBE_ADMIN_PASSWORD` ã‚’æ›´æ–°
  - GitLab CI/CDç’°å¢ƒå¤‰æ•° `SONAR_TOKEN` ã‚‚å†ç”Ÿæˆã—ã¦æ›´æ–°ã—ã¦ãã ã•ã„

#### 4. pgAdmin
```
URL: http://${EC2_PUBLIC_IP}:5002
Email: admin@example.com
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: ${PGADMIN_PASSWORD}
```

#### 5. PostgreSQL
```
ãƒ›ã‚¹ãƒˆ: localhost
ãƒãƒ¼ãƒˆ: 5001
ãƒ¦ãƒ¼ã‚¶ãƒ¼å: cicduser
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: cicd_postgres_pass_2026
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: cicddb
```

### SonarQubeãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# 1. SonarQubeã«ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€å³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ â†’ My Account â†’ Security

# 2. "Generate Token" ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
#    Name: gitlab-ci
#    Type: Project Analysis Token or Global Analysis Token

# 3. ç”Ÿæˆã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨­å®š
vi .env
# SONAR_TOKEN=sqa_xxxxxxxxxxxxxxxxxxxxx

# 4. GitLab CI/CDç’°å¢ƒå¤‰æ•°ã«ã‚‚è¨­å®š
#    GitLab â†’ Settings â†’ CI/CD â†’ Variables
#    Key: SONAR_TOKEN
#    Value: sqa_xxxxxxxxxxxxxxxxxxxxx
#    Flags: Masked
```

---

## ğŸ“¦ ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### æ¦‚è¦

çµ„ç¹”ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - Spring Boot + Reactã«ã‚ˆã‚‹3éšå±¤CRUD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### æ©Ÿèƒ½ä¸€è¦§

#### 1. çµ„ç¹”ç®¡ç†ï¼ˆOrganizationsï¼‰
- çµ„ç¹”ã®ä½œæˆã€å‚ç…§ã€æ›´æ–°ã€å‰Šé™¤
- çµ„ç¹”ã‚³ãƒ¼ãƒ‰ã€åç§°ã€è¨­ç«‹æ—¥ã€èª¬æ˜ã®ç®¡ç†
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

#### 2. éƒ¨ç½²ç®¡ç†ï¼ˆDepartmentsï¼‰
- éƒ¨ç½²ã®ä½œæˆã€å‚ç…§ã€æ›´æ–°ã€å‰Šé™¤
- çµ„ç¹”ã¸ã®æ‰€å±ç®¡ç†
- éšå±¤æ§‹é€ ï¼ˆè¦ªéƒ¨ç½²-å­éƒ¨ç½²ï¼‰
- éƒ¨ç½²ã‚³ãƒ¼ãƒ‰ã€åç§°ã€èª¬æ˜ã®ç®¡ç†

#### 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆUsersï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã€å‚ç…§ã€æ›´æ–°ã€å‰Šé™¤
- éƒ¨ç½²ã¸ã®æ‰€å±ç®¡ç†
- ç¤¾å“¡ç•ªå·ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ¡ãƒ¼ãƒ«ã€æ°åã€é›»è©±ç•ªå·ã€å½¹è·ã®ç®¡ç†
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### Organizations API
```
GET    /api/organizations         # å…¨çµ„ç¹”å–å¾—
GET    /api/organizations/{id}    # çµ„ç¹”è©³ç´°å–å¾—
POST   /api/organizations         # çµ„ç¹”ä½œæˆ
PUT    /api/organizations/{id}    # çµ„ç¹”æ›´æ–°
DELETE /api/organizations/{id}    # çµ„ç¹”å‰Šé™¤
GET    /api/organizations/code/{code}  # ã‚³ãƒ¼ãƒ‰ã§çµ„ç¹”æ¤œç´¢
```

#### Departments API
```
GET    /api/departments           # å…¨éƒ¨ç½²å–å¾—
GET    /api/departments/{id}      # éƒ¨ç½²è©³ç´°å–å¾—
POST   /api/departments           # éƒ¨ç½²ä½œæˆ
PUT    /api/departments/{id}      # éƒ¨ç½²æ›´æ–°
DELETE /api/departments/{id}      # éƒ¨ç½²å‰Šé™¤
GET    /api/departments/organization/{orgId}  # çµ„ç¹”åˆ¥éƒ¨ç½²ä¸€è¦§
```

#### Users API
```
GET    /api/users                 # å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—
GET    /api/users/{id}            # ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾—
POST   /api/users                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
PUT    /api/users/{id}            # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
DELETE /api/users/{id}            # ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
GET    /api/users/department/{deptId}  # éƒ¨ç½²åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
GET    /api/users/employee/{employeeNumber}  # ç¤¾å“¡ç•ªå·æ¤œç´¢
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```bash
cd sample-app
mvn clean install

cd backend
mvn spring-boot:run

# ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:8501
# Swagger UI: http://localhost:8501/swagger-ui.html
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```bash
cd sample-app/frontend
npm install
npm run dev

# ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:3000
```

#### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
cd sample-app
mvn clean test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
mvn jacoco:report
open backend/target/site/jacoco/index.html

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
cd frontend
npm test
npm test -- --coverage
```

---

## ğŸ”„ CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆï¼ˆ6ã‚¹ãƒ†ãƒ¼ã‚¸ï¼‰

`.gitlab-ci.yml` ã§å®šç¾©ã•ã‚ŒãŸè‡ªå‹•åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³:

```
build â†’ test â†’ coverage â†’ sonarqube â†’ package â†’ deploy
```

#### 1. Build ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- Maven ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
- æˆæœç‰©: target/classes
- å®Ÿè¡Œæ™‚é–“: ~1åˆ†
```

#### 2. Test ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- JUnit 5 å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆJUnit XMLï¼‰
- JaCoCo ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- æˆæœç‰©: surefire-reports, jacoco
- å®Ÿè¡Œæ™‚é–“: ~2åˆ†
```

#### 3. Coverage ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- JaCoCo ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ã‚«ãƒãƒ¬ãƒƒã‚¸é›†è¨ˆï¼ˆè¡Œã‚«ãƒãƒ¬ãƒƒã‚¸/ãƒ–ãƒ©ãƒ³ãƒã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- æˆæœç‰©: jacoco HTML/XML ãƒ¬ãƒãƒ¼ãƒˆ
- å®Ÿè¡Œæ™‚é–“: ~30ç§’
```

#### 4. SonarQube ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- é™çš„ã‚³ãƒ¼ãƒ‰è§£æå®Ÿè¡Œ
- å“è³ªã‚²ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
- ãƒã‚°ã€è„†å¼±æ€§ã€ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ¡ãƒ«æ¤œå‡º
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆé€ä¿¡
- ãƒ–ãƒ©ãƒ³ãƒ: master ã®ã¿
- å®Ÿè¡Œæ™‚é–“: ~1-2åˆ†
```

#### 5. Package ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- Maven ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ï¼ˆJARç”Ÿæˆï¼‰
- ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ—¢ã«å®Ÿè¡Œæ¸ˆã¿ï¼‰
- æˆæœç‰©: backend-1.0.0.jar
- ãƒ–ãƒ©ãƒ³ãƒ: master ã®ã¿
- å®Ÿè¡Œæ™‚é–“: ~1åˆ†
```

#### 6. Deploy ã‚¹ãƒ†ãƒ¼ã‚¸
```yaml
- Nexus Repository ã¸ãƒ‡ãƒ—ãƒ­ã‚¤
- .ci-settings.xml.template ã‹ã‚‰å‹•çš„è¨­å®šç”Ÿæˆ
- Maven ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ãƒ–ãƒ©ãƒ³ãƒ: master ã®ã¿
- å®Ÿè¡Œæ™‚é–“: ~1åˆ†
```

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

#### è‡ªå‹•å®Ÿè¡Œ
```bash
# ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥ã§è‡ªå‹•å®Ÿè¡Œ
cd sample-app
git add .
git commit -m "feat: æ–°æ©Ÿèƒ½è¿½åŠ "
git push origin master
```

#### æ‰‹å‹•å®Ÿè¡Œ
```
GitLab UI â†’ CI/CD â†’ Pipelines â†’ Run Pipeline
```

### å“è³ªã‚²ãƒ¼ãƒˆåŸºæº–

SonarQubeã§è¨­å®šã•ã‚ŒãŸå“è³ªåŸºæº–:

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | åŸºæº–å€¤ |
|----------|--------|
| è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸ | â‰¥ 80% |
| ãƒ–ãƒ©ãƒ³ãƒã‚«ãƒãƒ¬ãƒƒã‚¸ | â‰¥ 70% |
| é‡å¤§ãƒã‚° | 0ä»¶ |
| è„†å¼±æ€§ï¼ˆé«˜ãƒªã‚¹ã‚¯ï¼‰ | 0ä»¶ |
| ã‚³ãƒ¼ãƒ‰é‡è¤‡ç‡ | â‰¤ 3% |
| ä¿å®ˆæ€§ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | A |

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æœ€é©åŒ–

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Maven `.m2/repository` ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ä¾å­˜é–¢ä¿‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚é–“çŸ­ç¸®
- **ä¸¦åˆ—åŒ–**: å„ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é †æ¬¡å®Ÿè¡Œã€ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º
- **æ¡ä»¶ä»˜ãå®Ÿè¡Œ**: master ãƒ–ãƒ©ãƒ³ãƒã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å®Ÿè¡Œ
- **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ**: ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã¨ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’1é€±é–“ä¿æŒ

---

## ğŸ› ï¸ é‹ç”¨ç®¡ç†

### é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | èª¬æ˜ | ç”¨é€” |
|----------|------|------|
| `setup-from-scratch.sh` | ã‚¼ãƒ­ã‹ã‚‰å®Œå…¨ç’°å¢ƒæ§‹ç¯‰ï¼ˆ12ã‚¹ãƒ†ãƒƒãƒ—ã€ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒï¼‰ | æ–°è¦ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã€å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— |
| `setup-sample-app.sh` | **CI/CDæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆè¤‡æ•°å›å®Ÿè¡Œå¯¾å¿œï¼‰** | **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã®CI/CDå‹•ä½œæ¤œè¨¼** |
| `setup-cicd.sh` | CI/CDç’°å¢ƒè‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆ6ã‚¹ãƒ†ãƒƒãƒ—ã€Runnerç™»éŒ²ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆï¼‰ | CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ã€sample-appé€£æº |
| `show-credentials.sh` | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼æƒ…å ±è¡¨ç¤º | èªè¨¼æƒ…å ±ç¢ºèªã€ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› |
| `update-passwords.sh` | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ãƒ»EC2ãƒ›ã‚¹ãƒˆæ›´æ–° | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã€EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å¤‰æ›´ |
| `backup-all.sh` | å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ç§»è¡Œå‰ |
| `restore-all.sh` | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ | ç½å®³å¾©æ—§ã€ç’°å¢ƒç§»è¡Œ |
| `cleanup-all.sh` | å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤ | ç’°å¢ƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— |
| `deploy-oneclick.sh` | ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å†ãƒ‡ãƒ—ãƒ­ã‚¤ | ç’°å¢ƒãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ |

### 0. CI/CDæ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆsetup-sample-app.shï¼‰

#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¦‚è¦

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã«CI/CDç’°å¢ƒãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚

```bash
# åŸºæœ¬å®Ÿè¡Œï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰
./scripts/setup-sample-app.sh
```

#### è¤‡æ•°å›å®Ÿè¡Œå¯¾å¿œæ©Ÿèƒ½ï¼ˆv2.1.0ï¼‰

**å®‰å…¨ãªè¤‡æ•°å›å®Ÿè¡Œ**:
- âœ… **å®Ÿè¡ŒIDç®¡ç†**: `YYYYMMDD-HHMMSS`å½¢å¼ã®å®Ÿè¡Œè­˜åˆ¥å­
- âœ… **ãƒ—ãƒ­ã‚»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: æ—¢å­˜ã®`git-upload-pack`ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†
- âœ… **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: `/tmp/gitlab-sample-app`ã®å®Œå…¨å‰Šé™¤ãƒ»å†ä½œæˆ
- âœ… **Gitç«¶åˆè‡ªå‹•è§£æ±º**: `--allow-unrelated-histories`ã«ã‚ˆã‚‹è‡ªå‹•ãƒãƒ¼ã‚¸
- âœ… **ãƒªãƒ¢ãƒ¼ãƒˆå®‰å…¨è¨­å®š**: æ—¢å­˜ãƒªãƒ¢ãƒ¼ãƒˆå‰Šé™¤å¾Œã®å†è¨­å®š

**å®Ÿè¡Œãƒ­ã‚°ä¾‹**:
```bash
[1/8] ç‹¬ç«‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆä¸­... (å®Ÿè¡ŒID: 20260110-141641)
  ğŸ§¹ æ—¢å­˜å®Ÿè¡Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­...
  âœ“ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†
  âœ“ ç‹¬ç«‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆå®Œäº†: /tmp/gitlab-sample-app

[6/8] GitLabã«ãƒ—ãƒƒã‚·ãƒ¥ä¸­...
  ãƒªãƒ¢ãƒ¼ãƒˆã¨ã®ç«¶åˆã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚è‡ªå‹•ãƒãƒ¼ã‚¸ä¸­...
  âœ“ è‡ªå‹•ãƒãƒ¼ã‚¸å®Œäº†
  âœ“ GitLabãƒ—ãƒƒã‚·ãƒ¥å®Œäº†

[8/8] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡ŒçŠ¶æ³ç›£è¦–ä¸­...
  ğŸ”„ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œä¸­... (3/5 ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†)
  âœ… CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ã‚¹ãƒ†ãƒ¼ã‚¸æˆåŠŸï¼ˆ5å€‹ã®ã‚¸ãƒ§ãƒ–å®Œäº†ï¼‰
```

#### æ¤œè¨¼é …ç›®

**çµ±åˆã‚µãƒ¼ãƒ“ã‚¹ç¢ºèª**:
1. **GitLab**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ãƒ—ãƒƒã‚·ãƒ¥ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³èµ·å‹•
2. **GitLab Runner**: Shell executor ã§ã®ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ
3. **Maven**: ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. **JaCoCo**: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆ80%é”æˆç¢ºèªï¼‰
5. **Nexus**: maven-snapshotsã¸ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤

**CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ5ã‚¹ãƒ†ãƒ¼ã‚¸ï¼‰**:
```
Build â†’ Test â†’ Coverage â†’ Package â†’ Deploy
 12s    24s      7s        13s       14s
```

#### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–**:

```bash
# GitLab Runneræœªèµ·å‹•ã®å ´åˆ
sudo systemctl start gitlab-runner
sudo systemctl status gitlab-runner

# ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å¤±æ•—æ™‚ã®è©³ç´°ç¢ºèª
# GitLab UI â†’ Projects â†’ sample-app â†’ CI/CD â†’ Pipelines

# Nexusã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆç¢ºèª
curl -u admin:${NEXUS_ADMIN_PASSWORD} \
  "http://${EC2_PUBLIC_IP}:8082/service/rest/v1/search?repository=maven-snapshots&q=sample-app"
```

### 1. èªè¨¼æƒ…å ±ç®¡ç†

#### èªè¨¼æƒ…å ±ã®è¡¨ç¤º

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼æƒ…å ±ã‚’è¡¨ç¤º
./scripts/show-credentials.sh

# ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ï¼ˆ600ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼‰
./scripts/show-credentials.sh --file
# å‡ºåŠ›å…ˆ: /root/aws.git/container/claudecode/CICD/credentials.txt

# è¡¨ç¤ºå†…å®¹:
# - CI/CDã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGitLabã€Nexusã€SonarQubeã€pgAdminï¼‰
# - PostgreSQLã‚¹ã‚­ãƒ¼ãƒåˆ¥èªè¨¼æƒ…å ±ï¼ˆ4ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
# - CI/CDãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆSONAR_TOKENã€RUNNER_TOKENï¼‰
# - åˆå›ãƒ­ã‚°ã‚¤ãƒ³æ‰‹é †ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒå¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ï¼‰
```

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»è¨­å®šã®æ›´æ–°

```bash
# ç¾åœ¨ã®è¨­å®šã‚’è¡¨ç¤º
./scripts/update-passwords.sh --show

# å€‹åˆ¥æ›´æ–°
./scripts/update-passwords.sh --gitlab NewPassword123!
./scripts/update-passwords.sh --nexus NewPassword123!
./scripts/update-passwords.sh --sonarqube NewPassword123!

# SonarQubeãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
./scripts/update-passwords.sh --sonar-token sqa_xxxxxxxxxxxxxxxx

# EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPã‚¢ãƒ‰ãƒ¬ã‚¹æ›´æ–°
./scripts/update-passwords.sh --ec2-host ec2-34-205-156-203.compute-1.amazonaws.com
./scripts/update-passwords.sh --ec2-host 192.168.1.100

# å…¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€æ‹¬æ›´æ–°ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã‚’é™¤ãï¼‰
./scripts/update-passwords.sh --all Degital2026!

# æ›´æ–°å†…å®¹:
# - è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆ.env.backup.YYYYMMDDHHMMSSï¼‰
# - .envãƒ•ã‚¡ã‚¤ãƒ«ã®è©²å½“é …ç›®ã‚’æ›´æ–°
# - å¤‰æ›´å¾Œã®å†èµ·å‹•ãŒå¿…è¦ãªå ´åˆã¯æ¡ˆå†…è¡¨ç¤º
```

**é‡è¦**:
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´å¾Œã€é–¢é€£ã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•ãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™
- EC2ãƒ‰ãƒ¡ã‚¤ãƒ³åå¤‰æ›´å¾Œã€sample-appã®git remoteã‚‚æ›´æ–°ã—ã¦ãã ã•ã„
- GitLab CI/CDç’°å¢ƒå¤‰æ•°ï¼ˆSONAR_TOKENã€NEXUS_ADMIN_PASSWORDï¼‰ã‚‚åˆã‚ã›ã¦æ›´æ–°

### 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/backup-all.sh

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å†…å®¹
# - å…¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆdocker-compose.ymlã€.envã€config/ï¼‰
# - GitLab ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆgitlab-backup.tarï¼‰
# - GitLab ãƒªãƒã‚¸ãƒˆãƒªï¼ˆsample-app.bundleï¼‰
# - GitLab Runner è¨­å®š
# - Maven è¨­å®š
# - ç’°å¢ƒæƒ…å ±

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ
# backup-YYYYMMDD-HHMMSS/       # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
# backup-YYYYMMDD-HHMMSS.tar.gz # ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆç´„4-10MBï¼‰
```

### 2. å¾©å…ƒ

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®å±•é–‹
tar xzf backup-20260110-075148.tar.gz

# å¾©å…ƒå®Ÿè¡Œï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/restore-all.sh backup-20260110-075148

# å¾©å…ƒå†…å®¹
# - ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ï¼†å‰Šé™¤
# - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¾©å…ƒ
# - ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•
# - GitLab ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©å…ƒ
# - GitLab ãƒªãƒã‚¸ãƒˆãƒªå¾©å…ƒ
# - GitLab Runner è¨­å®šå¾©å…ƒ
# - Maven è¨­å®šå¾©å…ƒ
```

### 3. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
# å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤ï¼ˆç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ã‚Šã€sudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/cleanup-all.sh

# å‰Šé™¤å¯¾è±¡
# - å…¨ã‚³ãƒ³ãƒ†ãƒŠï¼ˆcicd-*ï¼‰
# - å…¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ï¼ˆcicd-*ï¼‰
# - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆcicd-networkï¼‰
# - GitLab Runner è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# - Maven è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

### 4. ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯å†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— â†’ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— â†’ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’ä¸€æ‹¬å®Ÿè¡Œï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/deploy-oneclick.sh

# å‡¦ç†ãƒ•ãƒ­ãƒ¼
# 1. ç¾åœ¨ã®ç’°å¢ƒã‚’å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
# 2. å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
# 3. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
# 4. ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ç¢ºèª
```

### 5. å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®è‡ªå‹•åŒ–

```bash
# cronã§æ¯æ—¥åˆå‰3æ™‚ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
sudo tee /etc/cron.d/cicd-backup > /dev/null <<'EOF'
0 3 * * * ec2-user /root/aws.git/container/claudecode/CICD/scripts/backup-all.sh
EOF

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤ï¼ˆ30æ—¥ä»¥å‰ï¼‰
# ä»¥ä¸‹ã‚’ cron ã«è¿½åŠ 
0 4 * * * find /root/aws.git/container/claudecode/CICD/backup-* -type f -name "*.tar.gz" -mtime +30 -delete
```

### 6. ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
cd /root/aws.git/container/claudecode/CICD
podman-compose up -d

# å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
podman-compose down

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•
podman-compose restart gitlab
podman-compose restart nexus
podman-compose restart sonarqube

# ãƒ­ã‚°ç¢ºèª
podman-compose logs -f gitlab
podman-compose logs -f nexus
podman-compose logs -f sonarqube

# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
podman stats
```

---

## âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¤œè¨¼çµæœ

### ç¬¬4å›å®Œå…¨æ¤œè¨¼å®Œäº†ï¼ˆ2026-01-10ï¼‰

ã‚¼ãƒ­ã‹ã‚‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®å¦¥å½“æ€§ã«ã¤ã„ã¦ã€8ã¤ã®ä¸»è¦é ˜åŸŸã§ç³»çµ±çš„ãªæ¤œè¨¼ã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚

#### âœ… æ¤œè¨¼å®Œäº†é …ç›®

| é …ç›® | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©³ç´° |
|------|-----------|------|
| **ç’°å¢ƒå¤‰æ•°ä¸€è²«æ€§** | âœ… æ­£å¸¸ | docker-compose.ymlã€CI/CDã€Mavenè¨­å®šã§ç’°å¢ƒå¤‰æ•°å‚ç…§ãŒé©åˆ‡ |
| **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** | âœ… æ­£å¸¸ | PostgreSQL init.sqlã€CIè¨­å®šã§å‹•çš„ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½¿ç”¨ |
| **Dockerä¾å­˜é–¢ä¿‚** | âœ… æ­£å¸¸ | ã‚µãƒ¼ãƒ“ã‚¹ä¾å­˜é–¢ä¿‚ã€ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šãŒé©åˆ‡ |
| **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †** | âœ… æ­£å¸¸ | 12ã‚¹ãƒ†ãƒƒãƒ—ã®è«–ç†çš„æ•´åˆæ€§ã€ç’°å¢ƒå¤‰æ•°ç”Ÿæˆã€ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒæ©Ÿèƒ½ |
| **GitLab Runnerè¨­å®š** | âš ï¸ æ³¨æ„å¿…è¦ | systemdè¨­å®šã¯é©åˆ‡ã ãŒã€äºŒé‡è¨­å®šå•é¡Œã‚ã‚Šï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ |
| **Mavenè¨­å®šç¶™æ‰¿** | âœ… æ­£å¸¸ | è¦ªPOMã€å­POMã€å‹•çš„Nexus URLç½®æ›ãŒé©åˆ‡ã«æ©Ÿèƒ½ |
| **CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** | âœ… æ­£å¸¸ | 6ã‚¹ãƒ†ãƒ¼ã‚¸ã€ç’°å¢ƒå¤‰æ•°ä½¿ç”¨ã€å“è³ªã‚²ãƒ¼ãƒˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ** | âœ… æ­£å¸¸ | Flywayã€JPAã€åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ |

#### âš ï¸ ç™ºè¦‹ã•ã‚ŒãŸé‡è¦ãªè¨­å®šå•é¡Œ

##### 1. **GitLab Runner äºŒé‡è¨­å®šå•é¡Œ**ï¼ˆé‡è¦ï¼‰
- **å•é¡Œ**: ã‚³ãƒ³ãƒ†ãƒŠãƒ™ãƒ¼ã‚¹ï¼ˆdocker-compose.ymlï¼‰ã¨ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆsetup-from-scratch.shï¼‰ã®ä¸¡æ–¹è¨­å®š
- **å½±éŸ¿**: ãƒªã‚½ãƒ¼ã‚¹ç«¶åˆã€å®Ÿè¡Œç’°å¢ƒã®ä¸æ•´åˆ
- **æ¨å¥¨**: ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ï¼ˆshell executorï¼‰ã«çµ±ä¸€ï¼ˆCLAUDE.mdæº–æ‹ ï¼‰

##### 2. **GitLab Runner ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ä¸è¶³**
- **å ´æ‰€**: `scripts/setup-from-scratch.sh:358-361`
- **å•é¡Œ**: `--token` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¬ å¦‚
- **ä¿®æ­£**:
```bash
sudo gitlab-runner register \
  --url http://${EC2_HOST}:5003 \
  --token YOUR_REGISTRATION_TOKEN \  # <- ã“ã®è¡ŒãŒå¿…è¦
  --executor shell \
  --description 'CICD Shell Runner'
```

##### 3. **Maven POM è¦ªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šä¸å‚™**
- **å ´æ‰€**: `sample-app/pom.xml:16-18`
- **å•é¡Œ**: modules ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã« `common` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæœªè¨˜è¼‰
- **ç¾åœ¨**: `<module>backend</module>` ã®ã¿
- **å¿…è¦**: `<module>common</module>` ã¨ `<module>backend</module>` ä¸¡æ–¹

##### 4. **setup-from-scratch.sh ã‚¹ãƒ†ãƒƒãƒ—ç•ªå·ä¸æ•´åˆ**
- **å•é¡Œ**: ã‚³ãƒ¡ãƒ³ãƒˆç•ªå·ã¨ echo ç•ªå·ã®ä¸ä¸€è‡´
- **ä¾‹**: `# 7. ç’°å¢ƒå¤‰æ•°...` â†’ `echo "[8/12] Docker Compose..."`
- **å½±éŸ¿**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´åˆæ€§

##### 5. **sample-backend ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ¬ å¦‚**ï¼ˆè»½å¾®ï¼‰
- **å•é¡Œ**: sample-backend ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æœªå®šç¾©
- **å½±éŸ¿**: sample-frontend ä¾å­˜é–¢ä¿‚ã§ç«¶åˆçŠ¶æ…‹ã®å¯èƒ½æ€§

#### ğŸ”§ æ¨å¥¨ä¿®æ­£äº‹é …

##### æœ€å„ªå…ˆï¼ˆé‹ç”¨ã«å½±éŸ¿ï¼‰
1. **GitLab Runner ã‚³ãƒ³ãƒ†ãƒŠè¨­å®šã‚’ docker-compose.yml ã‹ã‚‰å‰Šé™¤**
2. **GitLab Runner ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰ã« `--token` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ **
3. **Maven è¦ªPOM ã« common ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ **

##### æ¬¡å„ªå…ˆï¼ˆä¿å®ˆæ€§å‘ä¸Šï¼‰
4. **setup-from-scratch.sh ã®ã‚¹ãƒ†ãƒƒãƒ—ç•ªå·çµ±ä¸€**
5. **sample-backend ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¿½åŠ **

#### ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“è©•ä¾¡

**ç·åˆåˆ¤å®š**: âœ… **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¯èƒ½ï¼ˆè»½å¾®ãªå•é¡Œã‚ã‚Šï¼‰**

- ğŸŸ¢ **ã‚³ã‚¢æ©Ÿèƒ½**: CI/CDç’°å¢ƒã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯å…¨ã¦å‹•ä½œå¯èƒ½
- ğŸŸ¢ **ç’°å¢ƒå¤‰æ•°ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†**: å‹•çš„EC2å¯¾å¿œã€ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒæ©Ÿèƒ½ãŒé©åˆ‡ã«å®Ÿè£…
- ğŸŸ¡ **GitLab Runner**: äºŒé‡è¨­å®šå•é¡ŒãŒã‚ã‚‹ãŒã€ãƒ›ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹è¨­å®šã§å‹•ä½œå¯èƒ½
- ğŸŸ¡ **Maven ãƒ“ãƒ«ãƒ‰**: common ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å€‹åˆ¥ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã ãŒã€æ©Ÿèƒ½çš„ã«ã¯å•é¡Œãªã—

**çµè«–**: ç¾åœ¨ã®è¨­å®šã§ã‚‚åŸºæœ¬çš„ãª CI/CD ç’°å¢ƒã®æ§‹ç¯‰ãƒ»é‹ç”¨ã¯å¯èƒ½ã§ã™ã€‚ä¸Šè¨˜ä¿®æ­£ã«ã‚ˆã‚Šå®‰å®šæ€§ã¨ä¿å®ˆæ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1. ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„

**ç—‡çŠ¶**: `podman-compose up -d` å¾Œã€ã‚³ãƒ³ãƒ†ãƒŠãŒã™ãã«åœæ­¢ã™ã‚‹

**åŸå› ã¨å¯¾ç­–**:

#### SELinuxå•é¡Œ
```bash
# SELinuxã®çŠ¶æ…‹ç¢ºèª
getenforce

# Permissive ã«è¨­å®š
sudo setenforce 0
sudo sed -i 's/^SELINUX=enforcing/SELINUX=permissive/' /etc/selinux/config
```

#### ãƒãƒ¼ãƒˆç«¶åˆ
```bash
# ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
sudo ss -tuln | grep -E '5001|5002|5003|8000|8082'

# ç«¶åˆã—ã¦ã„ã‚‹å ´åˆã€docker-compose.yml ã®ãƒãƒ¼ãƒˆç•ªå·ã‚’å¤‰æ›´
```

#### ãƒ¡ãƒ¢ãƒªä¸è¶³
```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³ç¢ºèª
free -h

# SonarQubeç”¨ã®vm.max_map_countè¨­å®š
sudo sysctl -w vm.max_map_count=262144
echo "vm.max_map_count=262144" | sudo tee -a /etc/sysctl.conf
```

### 2. GitLab ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**ç—‡çŠ¶**: `curl http://localhost:5003` ã§ã‚¨ãƒ©ãƒ¼

**å¯¾ç­–**:
```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
podman ps -a | grep gitlab

# GitLabåˆæœŸåŒ–å®Œäº†ã¾ã§å¾…æ©Ÿï¼ˆ5-10åˆ†ï¼‰
podman logs -f cicd-gitlab

# "gitlab Reconfigured!" ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…ã¤

# åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªï¼ˆ24æ™‚é–“ä»¥å†…ï¼‰
podman exec -it cicd-gitlab cat /etc/gitlab/initial_root_password
```

### 3. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå¤±æ•—ã™ã‚‹

#### ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

##### Build ã‚¹ãƒ†ãƒ¼ã‚¸å¤±æ•—
```bash
# Mavenä¾å­˜é–¢ä¿‚ã®å•é¡Œ
cd sample-app
mvn clean install -U  # ä¾å­˜é–¢ä¿‚ã‚’å¼·åˆ¶æ›´æ–°

# Nexusãƒ—ãƒ­ã‚­ã‚·è¨­å®šç¢ºèª
curl http://localhost:8082/repository/maven-public/
```

##### Test ã‚¹ãƒ†ãƒ¼ã‚¸å¤±æ•—
```bash
# ãƒ†ã‚¹ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã—ã¦è©³ç´°ç¢ºèª
cd sample-app
mvn clean test -X  # ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

# ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å€‹åˆ¥å®Ÿè¡Œ
mvn test -Dtest=OrganizationServiceTest
```

##### SonarQube ã‚¹ãƒ†ãƒ¼ã‚¸å¤±æ•—
```bash
# SonarQubeãƒˆãƒ¼ã‚¯ãƒ³ç¢ºèª
# GitLab â†’ Settings â†’ CI/CD â†’ Variables â†’ SONAR_TOKEN

# SonarQubeæ¥ç¶šç¢ºèª
curl http://localhost:8000/api/system/status

# SonarQubeãƒ­ã‚°ç¢ºèª
podman logs cicd-sonarqube
```

##### Deploy ã‚¹ãƒ†ãƒ¼ã‚¸å¤±æ•—ï¼ˆ401 Unauthorizedï¼‰
```bash
# Nexusãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª
cat .env | grep NEXUS_ADMIN_PASSWORD

# GitLab CI/CDç’°å¢ƒå¤‰æ•°ç¢ºèª
# GitLab â†’ Settings â†’ CI/CD â†’ Variables â†’ NEXUS_ADMIN_PASSWORD

# Nexusãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª
curl -u admin:YOUR_PASSWORD http://localhost:8082/service/rest/v1/status
```

### 4. GitLab Runner ãŒå‹•ä½œã—ãªã„

```bash
# RunnerçŠ¶æ…‹ç¢ºèª
sudo systemctl status gitlab-runner

# Runnerå†èµ·å‹•
sudo systemctl restart gitlab-runner

# Runnerç™»éŒ²ç¢ºèª
sudo gitlab-runner list

# Runneræœªç™»éŒ²ã®å ´åˆã€å†ç™»éŒ²
sudo gitlab-runner register \
  --url http://${EC2_PUBLIC_IP}:5003 \
  --token YOUR_TOKEN \
  --executor shell \
  --description "CICD Shell Runner"

# Runnerãƒ­ã‚°ç¢ºèª
sudo journalctl -u gitlab-runner -f
```

### 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# PostgreSQLèµ·å‹•ç¢ºèª
podman ps | grep postgres

# PostgreSQLæ¥ç¶šãƒ†ã‚¹ãƒˆ
psql -h localhost -p 5001 -U cicduser -d cicddb

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ .env ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç¢ºèª
cat .env | grep POSTGRES_PASSWORD

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸€è¦§ç¢ºèª
psql -h localhost -p 5001 -U cicduser -d cicddb -c "\l"

# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ç¢ºèª
psql -h localhost -p 5001 -U cicduser -d cicddb -c "\dt"
```

### 6. SonarQubeå“è³ªã‚²ãƒ¼ãƒˆå¤±æ•—

```bash
# SonarQubeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª
# http://${EC2_PUBLIC_IP}:8000/dashboard?id=sample-app-backend

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³ã®å ´åˆ
cd sample-app
mvn clean test jacoco:report

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
open backend/target/site/jacoco/index.html

# ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ¡ãƒ«ã‚„ãƒã‚°ã®å ´åˆ
# SonarQube Issues ã‚¿ãƒ–ã§è©³ç´°ã‚’ç¢ºèªã—ã€ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£
```

### 7. ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³

```bash
# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨çŠ¶æ³ç¢ºèª
df -h

# Podmanæœªä½¿ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
podman image prune -a

# Podmanæœªä½¿ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤
podman volume prune

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤
find backup-* -type f -mtime +30 -delete

# Nexuså¤ã„ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆå‰Šé™¤
# Nexus UI â†’ Repository â†’ maven-snapshots â†’ Cleanup Policies
```

### 8. EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å†ä½œæˆæ™‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPå¤‰æ›´

**ç—‡çŠ¶**: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å†ä½œæˆã—ãŸã‚‰ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰ã‚ã£ã¦ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

**å¯¾ç­–**:

#### æ–¹æ³•1: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æ›´æ–°ï¼ˆæ¨å¥¨ï¼‰
```bash
# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã«ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPã‚’å†å…¥åŠ›ï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/setup-from-scratch.sh

# ã‚¹ãƒ†ãƒƒãƒ—6ã§æ–°ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPã‚’å…¥åŠ›
# ä¾‹: ec2-34-205-156-203.compute-1.amazonaws.com
# ä¾‹: 192.168.1.100

# æ—¢å­˜ã®.envãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€ãƒˆãƒ¼ã‚¯ãƒ³ã¯è‡ªå‹•ä¿æŒã•ã‚Œã¾ã™
```

#### æ–¹æ³•2: æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
```bash
# EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPã®ã¿æ›´æ–°
./scripts/update-passwords.sh --ec2-host ec2-34-205-156-203.compute-1.amazonaws.com

# è‡ªå‹•ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œæˆã•ã‚Œã¾ã™
# .env.backup.YYYYMMDDHHMMSS
```

#### æ–¹æ³•3: æ‰‹å‹•æ›´æ–°
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
vi .env

# EC2_PUBLIC_IP ã®å€¤ã‚’æ›´æ–°
EC2_PUBLIC_IP=ec2-34-205-156-203.compute-1.amazonaws.com

# Mavenè¨­å®šã‚‚æ›´æ–°ï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/setup-from-scratch.sh  # ã‚¹ãƒ†ãƒƒãƒ—11ã§Mavenè¨­å®šã‚’å†ç”Ÿæˆ
```

**å½±éŸ¿ç¯„å›²ã¨è¿½åŠ å¯¾å¿œ**:
```bash
# 1. sample-appã®git remoteã‚’æ›´æ–°
cd sample-app
git remote set-url origin http://NEW_IP:5003/root/sample-app.git

# 2. GitLab Runnerã®å†ç™»éŒ²ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
sudo gitlab-runner unregister --all-runners
sudo gitlab-runner register \
  --url http://NEW_IP:5003 \
  --token YOUR_TOKEN \
  --executor shell \
  --description "CICD Shell Runner"

# 3. èªè¨¼æƒ…å ±ã®ç¢ºèª
./scripts/show-credentials.sh
```

### 9. å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆå¤±

**ç—‡çŠ¶**: setup-from-scratch.sh ã‚’å†å®Ÿè¡Œã—ãŸã‚‰ã€SonarQubeãƒˆãƒ¼ã‚¯ãƒ³ã‚„GitLab Runnerãƒˆãƒ¼ã‚¯ãƒ³ãŒæ¶ˆãˆãŸ

**åŸå› **: æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ .env ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸Šæ›¸ãã•ã‚Œã¦ã„ã¾ã—ãŸ

**è§£æ±ºæ¸ˆã¿**:
- **æœ€æ–°ç‰ˆã§ã¯è‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æŒã—ã¾ã™**
- æ—¢å­˜ã® .env ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã€ä»¥ä¸‹ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•ä¿æŒ:
  - `SONAR_TOKEN`
  - `RUNNER_TOKEN`
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚‚ä½œæˆã•ã‚Œã¾ã™: `.env.backup.YYYYMMDDHHMMSS`

**ç¢ºèªæ–¹æ³•**:
```bash
# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‰
cat .env | grep -E "SONAR_TOKEN|RUNNER_TOKEN"

# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Ÿè¡Œï¼ˆsudoã§å®Ÿè¡Œï¼‰
sudo ./scripts/setup-from-scratch.sh

# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
cat .env | grep -E "SONAR_TOKEN|RUNNER_TOKEN"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚‚ç¢ºèªå¯èƒ½
ls -la .env.backup.*
```

**æ‰‹å‹•å¾©å…ƒãŒå¿…è¦ãªå ´åˆ**:
```bash
# æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp .env.backup.20260110123456 .env

# ã¾ãŸã¯ã€å€‹åˆ¥æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è¨­å®š
./scripts/update-passwords.sh --sonar-token sqa_xxxxxxxxxxxxx
./scripts/update-passwords.sh --runner-token glrt-xxxxxxxxxxxxx
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†

#### 1. ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹ç®¡ç†
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¸€å…ƒç®¡ç†
GITLAB_ROOT_PASSWORD=your_strong_password
NEXUS_ADMIN_PASSWORD=your_strong_password
SONARQUBE_ADMIN_PASSWORD=your_strong_password

# .envãƒ•ã‚¡ã‚¤ãƒ«ã¯ .gitignore ã«å«ã¾ã‚Œã¦ã„ã‚‹
# Gitãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œãªã„

# æ©Ÿå¯†æƒ…å ±ã‚‚ .gitignore ã§ä¿è­·
# - credentials.txtï¼ˆèªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
# - .env.backup.*ï¼ˆè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰
```

#### 2. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®è¨­å®š
```bash
# setup-from-scratch.sh å®Ÿè¡Œæ™‚ã«å¯¾è©±çš„å…¥åŠ›
# - æœ€ä½8æ–‡å­—
# - ç¢ºèªå…¥åŠ›ã«ã‚ˆã‚‹èª¤å…¥åŠ›é˜²æ­¢
# - è‹±æ•°å­—è¨˜å·ã®çµ„ã¿åˆã‚ã›æ¨å¥¨

# å†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã®å®‰å…¨æ©Ÿèƒ½
# - æ—¢å­˜.envãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡ºæ™‚ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•ä¿æŒ
# - .env.backup.YYYYMMDDHHMMSS å½¢å¼ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
# - SONAR_TOKENã€RUNNER_TOKENã¯æ¶ˆå¤±ã—ãªã„
```

#### 3. CI/CDã§ã®å–ã‚Šæ‰±ã„
```bash
# GitLab CI/CDç’°å¢ƒå¤‰æ•°ï¼ˆMaskedï¼‰
# Settings â†’ CI/CD â†’ Variables
SONAR_TOKEN=sqa_xxxxx...  (Masked)
NEXUS_ADMIN_PASSWORD=xxx  (Masked)

# .gitlab-ci.yml ã§ã¯ç’°å¢ƒå¤‰æ•°ã‚’å‚ç…§
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œãªã„
```

### æ¨å¥¨äº‹é …

#### 1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼
- æœ€ä½12æ–‡å­—ä»¥ä¸Š
- å¤§æ–‡å­—ã€å°æ–‡å­—ã€æ•°å­—ã€è¨˜å·ã‚’çµ„ã¿åˆã‚ã›ã‚‹
- è¾æ›¸ã«è¼‰ã£ã¦ã„ã‚‹å˜èªã‚’é¿ã‘ã‚‹
- å®šæœŸçš„ã«å¤‰æ›´ã™ã‚‹ï¼ˆ90æ—¥ã”ã¨ï¼‰

#### 2. ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
```bash
# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šï¼ˆå¿…è¦ãªãƒãƒ¼ãƒˆã®ã¿é–‹æ”¾ï¼‰
sudo firewall-cmd --permanent --add-port=5003/tcp  # GitLab
sudo firewall-cmd --permanent --add-port=8082/tcp  # Nexus
sudo firewall-cmd --permanent --add-port=8000/tcp  # SonarQube
sudo firewall-cmd --reload

# æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³
chmod 600 .env                  # ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«
chmod 600 .env.backup.*         # è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
chmod 600 credentials.txt       # èªè¨¼æƒ…å ±ï¼ˆshow-credentials.sh --file ã§ä½œæˆæ™‚ï¼‰

# ä½¿ç”¨å¾Œã¯èªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm -f credentials.txt
```

#### 3. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æš—å·åŒ–
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚’æš—å·åŒ–
gpg --symmetric --cipher-algo AES256 backup-20260110-075148.tar.gz

# å¾©å·åŒ–
gpg --decrypt backup-20260110-075148.tar.gz.gpg > backup-20260110-075148.tar.gz
```

#### 4. ç›£æŸ»ãƒ­ã‚°
```bash
# GitLabã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
podman exec cicd-gitlab cat /var/log/gitlab/nginx/gitlab_access.log

# Nexusãƒ­ã‚°
podman logs cicd-nexus

# SonarQubeãƒ­ã‚°
podman logs cicd-sonarqube
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [GitLab Documentation](https://docs.gitlab.com/)
- [Nexus Repository Manager Documentation](https://help.sonatype.com/repomanager3)
- [SonarQube Documentation](https://docs.sonarqube.org/latest/)
- [Spring Boot Documentation](https://spring.io/projects/spring-boot)
- [React Documentation](https://react.dev/)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£

**æ³¨æ„**: URLã®IPã‚¢ãƒ‰ãƒ¬ã‚¹éƒ¨åˆ†ã¯å®Ÿéš›ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

- **GitLab**: http://${EC2_PUBLIC_IP}:5003
- **Nexus**: http://${EC2_PUBLIC_IP}:8082
- **SonarQube**: http://${EC2_PUBLIC_IP}:8000
- **pgAdmin**: http://${EC2_PUBLIC_IP}:5002

### Issueç®¡ç†

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ **Issue #115** ã®ä¸€ç’°ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¾ã—ãŸã€‚

---

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å­¦ç¿’ãƒ»è©•ä¾¡ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¥ è²¢çŒ®è€…

- åˆæœŸå®Ÿè£…: Claude Code (Claude Sonnet 4.5)
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†: Issue #115

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆ:

1. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª
2. ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆ`podman logs <container_name>`ï¼‰
3. GitLabãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Issuesã«å ±å‘Š

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2026-01-11
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1.2

**å¤‰æ›´å±¥æ­´ (v2.1.2 - æœ€æ–°)**:
- âœ… **.gitlab-ci.yml YAMLæ§‹æ–‡ä¿®æ­£** - SonarQubeã‚¹ãƒ†ãƒ¼ã‚¸ã®ã‚³ãƒ­ãƒ³å«ã‚€echoæ–‡ã‚’å¼•ç”¨ç¬¦ã§ä¿®æ­£
- âœ… **SonarQube ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œ** - `-pl backend`ã‚ªãƒ—ã‚·ãƒ§ãƒ³å‰Šé™¤ã€è¦ªPOMã‹ã‚‰å®Ÿè¡Œ
- âœ… **GitLab Runnerè¨­å®šä¿®æ­£** - `tag_list`ã¨`run_untagged`è¨­å®šè¿½åŠ 
- âœ… **CI/CDç’°å¢ƒå¤‰æ•°è¨­å®šå®Œå…¨è‡ªå‹•åŒ–** - GitLab Rails Consoleã«ã‚ˆã‚‹5å¤‰æ•°è‡ªå‹•ç™»éŒ²
- âœ… **README ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ–¹æ³•æ˜ç¢ºåŒ–** - sudoå¿…é ˆ/é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œã®æ˜ç¤ºã€ä¸€è¦§è¡¨è¿½åŠ 
- âœ… **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨6ã‚¹ãƒ†ãƒ¼ã‚¸å‹•ä½œç¢ºèªå®Œäº†** - build/test/coverage/sonarqube/package/deploy

**å¤‰æ›´å±¥æ­´ (v2.1.1)**:
- âœ… **EC2 IPå¤‰å‹•å¯¾å¿œ** - å›ºå®šIPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç’°å¢ƒå¤‰æ•°å‚ç…§ã«å¤‰æ›´ã€è‡ªå‹•å–å¾—æ©Ÿèƒ½
- âœ… **setup-sample-app.sh è¤‡æ•°å›å®Ÿè¡Œå¯¾å¿œ** - è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€ç«¶åˆè§£æ±ºã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç›£è¦–
- âœ… **å³å¯†ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ˜è¨˜** - RHEL 9.7, Java 17.0.17, Spring Boot 3.2.1ç­‰
- âœ… **CI/CDæ¤œè¨¼æ‰‹é †ã®è‡ªå‹•åŒ–** - 8ã‚¹ãƒ†ãƒƒãƒ—ã®å®Œå…¨è‡ªå‹•æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆå¼•æ•°ä¸è¦ï¼‰
- âœ… **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç›£è¦–æ©Ÿèƒ½** - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—è¡¨ç¤ºã€å…¨6ã‚¹ãƒ†ãƒ¼ã‚¸æˆåŠŸç¢ºèª
- âœ… **å‹•ä½œæ¤œè¨¼æ¸ˆã¿ç’°å¢ƒã®æ˜ç¢ºåŒ–** - Podman 5.6.0, Maven 3.6.3, PostgreSQL 16ç­‰

**å¤‰æ›´å±¥æ­´ (v2.1.0)**:
- âœ… ãƒˆãƒ¼ã‚¯ãƒ³ä¿æŒæ©Ÿèƒ½ï¼ˆSONAR_TOKENã€RUNNER_TOKENï¼‰
- âœ… EC2ãƒ‰ãƒ¡ã‚¤ãƒ³å/IPå‹•çš„è¨­å®š
- âœ… èªè¨¼æƒ…å ±ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆshow-credentials.shã€update-passwords.shï¼‰
- âœ… è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ï¼ˆ.env.backup.*ï¼‰
- âœ… GitLabãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç’°å¢ƒå¤‰æ•°åŒ–
- âœ… Mavenè¨­å®šã®å‹•çš„ç½®æ›ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€EC2ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰

**å‹•ä½œæ¤œè¨¼å®Œäº†ç’°å¢ƒ**:
- âœ… **OS**: Red Hat Enterprise Linux 9.7 (Plow)
- âœ… **ã‚³ãƒ³ãƒ†ãƒŠ**: Podman 5.6.0, Docker Compose v3.8
- âœ… **Java**: OpenJDK 17.0.17 LTS (Red Hat build)
- âœ… **CI/CD**: GitLab CE latest, GitLab Runner latest (Shell executor)
- âœ… **å“è³ªç®¡ç†**: SonarQube 10-community, JaCoCo 0.8.11
- âœ… **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ**: Nexus 3.x latest, Maven 3.6.3
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL 16-alpine, pgAdmin latest
