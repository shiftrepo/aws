# Architecture Diagrams - Team Schedule Management System

This document contains visual diagrams to help understand the system architecture.

## 1. System Context Diagram (C4 Level 1)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           SYSTEM CONTEXT                                 │
│                                                                          │
│                                                                          │
│    ┌──────────┐                                        ┌──────────┐    │
│    │          │                                        │          │    │
│    │  Admin   │──────┐                          ┌─────│ Manager  │    │
│    │  User    │      │                          │     │   User   │    │
│    │          │      │                          │     │          │    │
│    └──────────┘      │                          │     └──────────┘    │
│                      │                          │                      │
│                      │    ┌──────────────────┐  │                      │
│                      └───>│                  │<─┘                      │
│                           │   Team Schedule  │                         │
│    ┌──────────┐    ┌────>│   Management     │<────┐   ┌──────────┐   │
│    │          │    │     │     System       │     │   │          │   │
│    │ Employee │────┘     │                  │     └───│  Email   │   │
│    │   User   │          │  [Web App]       │         │  System  │   │
│    │          │          │                  │         │ (Future) │   │
│    └──────────┘          └──────────────────┘         └──────────┘   │
│                                                                          │
│                                                                          │
│  Users interact via web browser to:                                    │
│  - View schedules                                                       │
│  - Manage shifts                                                        │
│  - Request time off                                                     │
│  - Swap shifts with teammates                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2. Container Diagram (C4 Level 2)

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                            CONTAINER VIEW                                      │
│                                                                                │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │                          Web Browser                                    │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │  │
│  │  │  React Single Page Application                                   │  │  │
│  │  │  - Schedule calendar interface                                   │  │  │
│  │  │  - Team member management                                        │  │  │
│  │  │  - Shift assignment UI                                           │  │  │
│  │  │  - Real-time notifications                                       │  │  │
│  │  │                                                                  │  │  │
│  │  │  [React 18 + Vite + TailwindCSS]                                │  │  │
│  │  └──────────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                          │
│                                    │ HTTPS/JSON                               │
│                                    ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │                      Nginx Reverse Proxy                                │  │
│  │  - SSL termination                                                      │  │
│  │  - Static file serving                                                  │  │
│  │  - API request routing                                                  │  │
│  │  - Compression (gzip)                                                   │  │
│  │                                                                         │  │
│  │  [Nginx 1.25-alpine]                                                    │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                          │
│                                    │ HTTP/JSON                                │
│                                    ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │                        API Application                                  │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Authentication Service                                           │  │  │
│  │  │  - JWT token generation/validation                               │  │  │
│  │  │  - Password hashing (bcrypt)                                     │  │  │
│  │  │  - Permission checking                                           │  │  │
│  │  └──────────────────────────────────────────────────────────────────┘  │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Business Logic Services                                          │  │  │
│  │  │  - Schedule generation                                            │  │  │
│  │  │  - Conflict detection                                             │  │  │
│  │  │  - Notification creation                                          │  │  │
│  │  │  - Report generation                                              │  │  │
│  │  └──────────────────────────────────────────────────────────────────┘  │  │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │  │
│  │  │  REST API Endpoints                                               │  │  │
│  │  │  /api/auth, /api/users, /api/shifts                              │  │  │
│  │  │  /api/schedule, /api/timeoff, /api/notifications                 │  │  │
│  │  └──────────────────────────────────────────────────────────────────┘  │  │
│  │                                                                         │  │
│  │  [Node.js 20 + Express 4]                                               │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                    │                                          │
│                                    │ SQL                                      │
│                                    ▼                                          │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │                        Database                                         │  │
│  │  - User accounts and roles                                              │  │
│  │  - Shift assignments and templates                                      │  │
│  │  - Schedule data                                                        │  │
│  │  - Time-off requests                                                    │  │
│  │  - Audit logs                                                           │  │
│  │                                                                         │  │
│  │  [SQLite 3 - File: /data/schedule.db]                                  │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                                                                │
└───────────────────────────────────────────────────────────────────────────────┘
```

## 3. Component Diagram - Backend (C4 Level 3)

```
┌───────────────────────────────────────────────────────────────────────────┐
│                      API APPLICATION COMPONENTS                            │
│                                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                     Middleware Layer                                │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐          │  │
│  │  │   CORS   │─>│  Body    │─>│  Cookie  │─>│  Auth    │          │  │
│  │  │  Handler │  │  Parser  │  │  Parser  │  │Validator │          │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘          │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                     Controller Layer                                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │    Auth     │  │    User     │  │   Shift     │                │  │
│  │  │ Controller  │  │ Controller  │  │ Controller  │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │  Schedule   │  │  Time Off   │  │Notification │                │  │
│  │  │ Controller  │  │ Controller  │  │ Controller  │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                      Service Layer                                  │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │    Auth     │  │    User     │  │   Shift     │                │  │
│  │  │  Service    │  │  Service    │  │  Service    │                │  │
│  │  │             │  │             │  │             │                │  │
│  │  │ - JWT ops   │  │ - Business  │  │ - Conflict  │                │  │
│  │  │ - Bcrypt    │  │   logic     │  │   detection │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │  Schedule   │  │  Time Off   │  │Notification │                │  │
│  │  │  Service    │  │  Service    │  │  Service    │                │  │
│  │  │             │  │             │  │             │                │  │
│  │  │ - Auto-gen  │  │ - Approval  │  │ - Event     │                │  │
│  │  │ - Optimize  │  │   workflow  │  │   handling  │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                    Repository Layer                                 │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │    User     │  │   Shift     │  │  Schedule   │                │  │
│  │  │ Repository  │  │ Repository  │  │ Repository  │                │  │
│  │  │             │  │             │  │             │                │  │
│  │  │ - CRUD ops  │  │ - Query     │  │ - Optimized │                │  │
│  │  │ - Queries   │  │   building  │  │   queries   │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │  ┌─────────────┐  ┌─────────────┐                                  │  │
│  │  │Notification │  │   Audit     │                                  │  │
│  │  │ Repository  │  │ Repository  │                                  │  │
│  │  │             │  │             │                                  │  │
│  │  │ - Event     │  │ - Logging   │                                  │  │
│  │  │   storage   │  │   ops       │                                  │  │
│  │  └─────────────┘  └─────────────┘                                  │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                     Database Layer                                  │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  better-sqlite3 Driver                                       │  │  │
│  │  │  - Connection pool management                                │  │  │
│  │  │  - Transaction handling                                      │  │  │
│  │  │  - Prepared statement caching                                │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│                      [SQLite Database]                                     │
│                                                                            │
└───────────────────────────────────────────────────────────────────────────┘
```

## 4. Component Diagram - Frontend (C4 Level 3)

```
┌───────────────────────────────────────────────────────────────────────────┐
│                     REACT APPLICATION COMPONENTS                           │
│                                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                      Context Providers                              │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │    Auth     │  │  Schedule   │  │Notification │                │  │
│  │  │  Provider   │  │  Provider   │  │  Provider   │                │  │
│  │  │             │  │             │  │             │                │  │
│  │  │ - User      │  │ - Shifts    │  │ - Alerts    │                │  │
│  │  │ - Login     │  │ - Filters   │  │ - Unread    │                │  │
│  │  │ - Logout    │  │ - CRUD      │  │   count     │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                       Page Components                               │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │  Dashboard  │  │  Schedule   │  │    Team     │                │  │
│  │  │    Page     │  │    Page     │  │  Members    │                │  │
│  │  │             │  │             │  │    Page     │                │  │
│  │  │ - Stats     │  │ - Calendar  │  │ - List      │                │  │
│  │  │ - Overview  │  │ - Filters   │  │ - Search    │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │   Shift     │  │  Time Off   │  │   Profile   │                │  │
│  │  │Management   │  │    Page     │  │    Page     │                │  │
│  │  │    Page     │  │             │  │             │                │  │
│  │  │ - Templates │  │ - Requests  │  │ - Edit      │                │  │
│  │  │ - Swaps     │  │ - Calendar  │  │ - Settings  │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                     Feature Components                              │  │
│  │                                                                     │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  Schedule Feature                                            │  │  │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │  │  │
│  │  │  │  Calendar    │  │  Shift Card  │  │  Assignment  │      │  │  │
│  │  │  │    View      │  │              │  │    Modal     │      │  │  │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘      │  │  │
│  │  │  ┌──────────────┐  ┌──────────────┐                        │  │  │
│  │  │  │  Drag Drop   │  │  Filter Bar  │                        │  │  │
│  │  │  │  Interface   │  │              │                        │  │  │
│  │  │  └──────────────┘  └──────────────┘                        │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │                                                                     │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  Team Feature                                                │  │  │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │  │  │
│  │  │  │   Member     │  │   Member     │  │    Add       │      │  │  │
│  │  │  │    List      │  │    Card      │  │   Member     │      │  │  │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘      │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  │                                                                     │  │
│  │  ┌─────────────────────────────────────────────────────────────┐  │  │
│  │  │  Notification Feature                                        │  │  │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │  │  │
│  │  │  │Notification  │  │Notification  │  │Notification  │      │  │  │
│  │  │  │   Center     │  │    List      │  │    Item      │      │  │  │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘      │  │  │
│  │  └─────────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                   Shared UI Components                              │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │  │
│  │  │  Button  │  │  Input   │  │  Select  │  │   Card   │           │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐           │  │
│  │  │  Modal   │  │  Toast   │  │ Tooltip  │  │  Spinner │           │  │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘           │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                      API Services                                   │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │  │
│  │  │    Auth     │  │    User     │  │   Shift     │                │  │
│  │  │     API     │  │     API     │  │     API     │                │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                │  │
│  │  ┌─────────────┐  ┌─────────────┐                                  │  │
│  │  │  Schedule   │  │Notification │                                  │  │
│  │  │     API     │  │     API     │                                  │  │
│  │  └─────────────┘  └─────────────┘                                  │  │
│  └────────────────────────────────────────────────────────────────────┘  │
│                              │                                             │
│                              ▼                                             │
│                      [Axios HTTP Client]                                   │
│                              │                                             │
│                              ▼                                             │
│                      [Backend API Server]                                  │
│                                                                            │
└───────────────────────────────────────────────────────────────────────────┘
```

## 5. Deployment Diagram

```
┌───────────────────────────────────────────────────────────────────────────┐
│                      DOCKER HOST ENVIRONMENT                               │
│                                                                            │
│  ┌────────────────────────────────────────────────────────────────────┐  │
│  │                   Docker Network: app-network                       │  │
│  │                      172.25.0.0/16                                  │  │
│  │                                                                     │  │
│  │  ┌───────────────────────────────────────────────────────────┐    │  │
│  │  │  nginx Container                                           │    │  │
│  │  │  Image: nginx:1.25-alpine                                  │    │  │
│  │  │  IP: 172.25.0.2                                            │    │  │
│  │  │                                                            │    │  │
│  │  │  Ports: 80:80, 443:443                                     │    │  │
│  │  │                                                            │    │  │
│  │  │  Volumes:                                                  │    │  │
│  │  │  - ./nginx/nginx.conf → /etc/nginx/nginx.conf            │    │  │
│  │  │  - ./frontend/dist → /usr/share/nginx/html               │    │  │
│  │  │  - nginx-logs → /var/log/nginx                            │    │  │
│  │  └───────────────────────────────────────────────────────────┘    │  │
│  │                            │                                        │  │
│  │                            │ app-network                            │  │
│  │         ┌──────────────────┴──────────────────┐                    │  │
│  │         │                                      │                    │  │
│  │         ▼                                      ▼                    │  │
│  │  ┌──────────────────────┐           ┌──────────────────────┐      │  │
│  │  │  frontend Container  │           │  backend Container   │      │  │
│  │  │  (Development Only)  │           │  Image: node:20      │      │  │
│  │  │  Image: node:20      │           │  IP: 172.25.0.4      │      │  │
│  │  │  IP: 172.25.0.3      │           │                      │      │  │
│  │  │                      │           │  Port: 3001:3001     │      │  │
│  │  │  Port: 3000:3000     │           │                      │      │  │
│  │  │                      │           │  Volumes:            │      │  │
│  │  │  Volumes:            │           │  - db-data →         │      │  │
│  │  │  - ./frontend →      │           │    /data             │      │  │
│  │  │    /app              │           │  - backend-logs →    │      │  │
│  │  │                      │           │    /app/logs         │      │  │
│  │  └──────────────────────┘           └──────────────────────┘      │  │
│  │                                              │                      │  │
│  └──────────────────────────────────────────────┼──────────────────────┘  │
│                                                 │                         │
│                                                 │                         │
│  ┌──────────────────────────────────────────────┼──────────────────────┐  │
│  │  Host Volumes                                │                      │  │
│  │                                              ▼                      │  │
│  │  ┌──────────────────────────────────────────────────────────────┐  │  │
│  │  │  db-data Volume                                               │  │  │
│  │  │  ./data/schedule.db                                          │  │  │
│  │  │  - Persistent SQLite database                                │  │  │
│  │  │  - Permissions: 600 (scheduleapp user)                       │  │  │
│  │  └──────────────────────────────────────────────────────────────┘  │  │
│  │                                                                     │  │
│  │  ┌──────────────────────────────────────────────────────────────┐  │  │
│  │  │  backend-logs Volume                                          │  │  │
│  │  │  Application logs (Winston)                                   │  │  │
│  │  └──────────────────────────────────────────────────────────────┘  │  │
│  │                                                                     │  │
│  │  ┌──────────────────────────────────────────────────────────────┐  │  │
│  │  │  nginx-logs Volume                                            │  │  │
│  │  │  Access and error logs                                        │  │  │
│  │  └──────────────────────────────────────────────────────────────┘  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                                                            │
│  External Access:                                                         │
│  - http://localhost:80 → nginx → frontend (production)                   │
│  - http://localhost:80/api → nginx → backend:3001                        │
│  - http://localhost:3000 → frontend-dev (development only)               │
│                                                                            │
└───────────────────────────────────────────────────────────────────────────┘
```

## 6. Database Entity Relationship Diagram

```
┌──────────────┐         ┌──────────────┐
│    roles     │◄────────│    users     │
├──────────────┤   1:N   ├──────────────┤
│ id (PK)      │         │ id (PK)      │
│ name         │         │ email        │
│ permissions  │         │ password_hash│
│ description  │         │ role_id (FK) │
│ created_at   │         │ first_name   │
└──────────────┘         │ last_name    │
                         │ phone        │
                         │ is_active    │
                         │ created_at   │
                         └──────────────┘
                                │
                         ┌──────┴──────┐
                         │             │
                    1:N  │             │  1:N
                         │             │
                         ▼             ▼
            ┌──────────────┐   ┌──────────────┐
            │   shifts     │   │   time_off   │
            ├──────────────┤   ├──────────────┤
            │ id (PK)      │   │ id (PK)      │
            │ user_id (FK) │   │ user_id (FK) │
            │ template_id  │   │ start_date   │
            │ shift_date   │   │ end_date     │
            │ start_time   │   │ type         │
            │ end_time     │   │ status       │
            │ status       │   │ reason       │
            │ notes        │   │ approved_by  │
            │ created_by   │   │ created_at   │
            │ created_at   │   └──────────────┘
            └──────────────┘
                    │
                    │ N:1
                    │
                    ▼
        ┌──────────────────┐
        │ shift_templates  │
        ├──────────────────┤
        │ id (PK)          │
        │ name             │
        │ start_time       │
        │ end_time         │
        │ color            │
        │ description      │
        │ is_active        │
        └──────────────────┘

┌──────────────────┐         ┌──────────────┐
│  shift_swaps     │    N:1  │   shifts     │
├──────────────────┤────────>│              │
│ id (PK)          │         │              │
│ shift_id (FK)    │         │              │
│ requester_id (FK)│         │              │
│ target_id (FK)   │         │              │
│ status           │         │              │
│ reason           │         │              │
│ approved_by      │         │              │
│ created_at       │         │              │
└──────────────────┘         └──────────────┘

┌──────────────────┐         ┌──────────────┐
│ notifications    │    N:1  │    users     │
├──────────────────┤────────>│              │
│ id (PK)          │         │              │
│ user_id (FK)     │         │              │
│ type             │         │              │
│ title            │         │              │
│ message          │         │              │
│ is_read          │         │              │
│ related_id       │         │              │
│ created_at       │         │              │
└──────────────────┘         └──────────────┘

┌──────────────────┐         ┌──────────────┐
│   audit_logs     │    N:1  │    users     │
├──────────────────┤────────>│              │
│ id (PK)          │         │              │
│ user_id (FK)     │         │              │
│ action           │         │              │
│ table_name       │         │              │
│ record_id        │         │              │
│ old_values       │         │              │
│ new_values       │         │              │
│ ip_address       │         │              │
│ timestamp        │         │              │
└──────────────────┘         └──────────────┘

┌──────────────────┐
│    settings      │
├──────────────────┤
│ id (PK)          │
│ key (UNIQUE)     │
│ value            │
│ type             │
│ description      │
│ updated_at       │
└──────────────────┘
```

## 7. Authentication Flow Sequence Diagram

```
User          Browser        Nginx         API Server      Database
 │                │            │               │               │
 │ Enter Creds    │            │               │               │
 │───────────────>│            │               │               │
 │                │            │               │               │
 │                │ POST /api/auth/login       │               │
 │                │───────────>│───────────────>│               │
 │                │            │               │               │
 │                │            │               │ SELECT user   │
 │                │            │               │──────────────>│
 │                │            │               │<──────────────│
 │                │            │               │  user record  │
 │                │            │               │               │
 │                │            │               │ bcrypt.compare│
 │                │            │               │<─────────────>│
 │                │            │               │  verified     │
 │                │            │               │               │
 │                │            │               │ jwt.sign()    │
 │                │            │               │<─────────────>│
 │                │            │               │  JWT token    │
 │                │            │               │               │
 │                │            │               │ UPDATE        │
 │                │            │               │ last_login_at │
 │                │            │               │──────────────>│
 │                │            │               │               │
 │                │            │               │ INSERT        │
 │                │            │               │ audit_logs    │
 │                │            │               │──────────────>│
 │                │            │               │               │
 │                │            │<───────────────│               │
 │                │<───────────│  Set-Cookie:  │               │
 │<───────────────│  authToken │               │               │
 │  Redirect to   │  + User    │               │               │
 │  Dashboard     │    Data    │               │               │
 │                │            │               │               │
 │                │            │               │               │
 │ Load Dashboard │            │               │               │
 │───────────────>│            │               │               │
 │                │ GET /api/schedule          │               │
 │                │ Cookie: authToken          │               │
 │                │───────────>│───────────────>│               │
 │                │            │               │ verify JWT    │
 │                │            │               │<─────────────>│
 │                │            │               │               │
 │                │            │               │ SELECT shifts │
 │                │            │               │──────────────>│
 │                │            │               │<──────────────│
 │                │            │<───────────────│               │
 │                │<───────────│  shift data   │               │
 │<───────────────│            │               │               │
 │  Render        │            │               │               │
 │  Schedule      │            │               │               │
 │                │            │               │               │
```

## 8. Data Flow Diagram - Shift Assignment

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      SHIFT ASSIGNMENT FLOW                               │
│                                                                          │
│  Manager                                                                │
│     │                                                                    │
│     │ 1. Open Assign Modal                                              │
│     │                                                                    │
│     ▼                                                                    │
│  ┌─────────────────┐                                                    │
│  │  React Form     │                                                    │
│  │  - Select User  │                                                    │
│  │  - Pick Date    │                                                    │
│  │  - Set Times    │                                                    │
│  └─────────────────┘                                                    │
│     │                                                                    │
│     │ 2. Submit Form                                                    │
│     │                                                                    │
│     ▼                                                                    │
│  ┌─────────────────┐                                                    │
│  │ Validation      │                                                    │
│  │ - Required      │                                                    │
│  │ - Date format   │                                                    │
│  │ - Time range    │                                                    │
│  └─────────────────┘                                                    │
│     │                                                                    │
│     │ 3. POST /api/shifts                                               │
│     │                                                                    │
│     ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────┐           │
│  │  API Server                                              │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 1. Authenticate (verify JWT)                    │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 2. Authorize (check shifts:assign permission)  │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 3. Validate Input                               │   │           │
│  │  │    - User exists and active                     │   │           │
│  │  │    - Date not in past                           │   │           │
│  │  │    - Valid time format                          │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 4. Check Business Rules                         │   │           │
│  │  │    - No overlapping shifts                      │   │           │
│  │  │    - Not on approved time-off                   │   │           │
│  │  │    - Within max hours per week                  │   │           │
│  │  │    - Min hours between shifts                   │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │          │                                              │           │
│  │          │ If conflicts found                           │           │
│  │          ▼                                              │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ Return 409 Conflict                             │   │           │
│  │  │ { error: "Overlapping shift detected" }         │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │          │                                              │           │
│  │          │ If validation passes                         │           │
│  │          ▼                                              │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 5. Insert Shift Record                          │   │           │
│  │  │    INSERT INTO shifts (...)                     │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 6. Create Notification (trigger)                │   │           │
│  │  │    INSERT INTO notifications (...)              │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 7. Create Audit Log                             │   │           │
│  │  │    INSERT INTO audit_logs (...)                 │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  │  ┌─────────────────────────────────────────────────┐   │           │
│  │  │ 8. Return Success Response                      │   │           │
│  │  │    { success: true, data: shift }               │   │           │
│  │  └─────────────────────────────────────────────────┘   │           │
│  └─────────────────────────────────────────────────────────┘           │
│     │                                                                    │
│     │ 4. Response received                                              │
│     │                                                                    │
│     ▼                                                                    │
│  ┌─────────────────┐                                                    │
│  │ Update UI       │                                                    │
│  │ - Add to list   │                                                    │
│  │ - Close modal   │                                                    │
│  │ - Show toast    │                                                    │
│  └─────────────────┘                                                    │
│                                                                          │
│  ┌──────────────────────────────────────────────────────┐              │
│  │  Employee (receives notification)                    │              │
│  │  - Real-time update in notification bell             │              │
│  │  - Shows: "New shift assigned on Oct 1"              │              │
│  └──────────────────────────────────────────────────────┘              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Diagram Legend

### Colors (when rendered)
- **Blue**: Primary components/containers
- **Purple**: Secondary components/features
- **Green**: Success flows/completed states
- **Orange**: Warning states/validations
- **Red**: Error states/conflicts
- **Gray**: Infrastructure/supporting components

### Symbols
- `→` : Data flow direction
- `◄►` : Bidirectional communication
- `┌─┐` : Container/component boundary
- `├─┤` : Section divider
- `(PK)` : Primary key in database
- `(FK)` : Foreign key in database
- `1:N` : One-to-many relationship
- `N:1` : Many-to-one relationship

## Tools for Rendering

These diagrams are designed as ASCII art for maximum portability. For professional rendering, consider:

1. **Mermaid.js** - Convert to Mermaid syntax for web rendering
2. **PlantUML** - Generate high-quality diagrams
3. **Draw.io** - Import and enhance manually
4. **Lucidchart** - Professional diagramming tool
5. **Excalidraw** - Hand-drawn style diagrams

## Updating Diagrams

When architecture changes:
1. Update relevant ASCII diagrams in this file
2. Update corresponding detailed documentation
3. Store updates in swarm memory via hooks
4. Notify other agents of architectural changes

---

**Document Version:** 1.0.0
**Last Updated:** October 1, 2025
