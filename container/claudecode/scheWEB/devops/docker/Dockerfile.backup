# Backup service for automated SQLite backups
FROM alpine:3.18

# Install required tools
RUN apk add --no-cache \
    sqlite \
    aws-cli \
    dcron \
    bash \
    && rm -rf /var/cache/apk/*

WORKDIR /backup

# Copy backup scripts
COPY devops/scripts/backup.sh /backup/backup.sh
COPY devops/scripts/restore.sh /backup/restore.sh

RUN chmod +x /backup/*.sh

# Create cron job
RUN echo "${BACKUP_SCHEDULE:-0 2 * * *} /backup/backup.sh" > /etc/crontabs/root

# Start cron in foreground
CMD ["crond", "-f", "-l", "2"]
