<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºãƒ†ã‚¹ãƒˆ - ken's 08:30-09:00ãƒ–ãƒ­ãƒƒã‚¯ç¢ºèª</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #4CAF50; border-radius: 8px; background: #f9f9f9; }
        .success { background: #E8F5E8; border-color: #4CAF50; }
        .error { background: #FFE6E6; border-color: #f44336; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ  - ken's 08:30ãƒ–ãƒ­ãƒƒã‚¯æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h1>

    <div class="test-section">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¨­å®š</h2>
        <p>å®Ÿéš›ã®APIãƒ‡ãƒ¼ã‚¿ã‚’æ¨¡æ“¬:</p>
        <pre id="test-data"></pre>
    </div>

    <div class="test-section">
        <h2>â° ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºçµæœ</h2>
        <div id="timeline-container"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” æ¤œè¨¼çµæœ</h2>
        <div id="verification-results"></div>
    </div>

    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿è¾¼ã¿ -->
    <script src="../app/frontend/schedule_display_v2.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ (å®Ÿéš›ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ¨¡æ“¬)
        const testUsers = [
            {
                id: 1,
                username: "admin",
                start_time: "09:00",
                end_time: "18:00",
                availability: {
                    monday: [{ start: "09:00", end: "10:00" }],
                    tuesday: [{ start: "09:00", end: "11:00" }],
                    wednesday: [{ start: "13:00", end: "17:00" }]
                }
            },
            {
                id: 2,
                username: "hoge",
                start_time: "09:00",
                end_time: "18:00",
                availability: {
                    monday: [{ start: "09:30", end: "10:30" }],
                    thursday: [
                        { start: "09:00", end: "10:00" },
                        { start: "10:00", end: "11:00" },
                        { start: "11:00", end: "12:00" }
                    ]
                }
            },
            {
                id: 3,
                username: "ken",
                start_time: "08:00",
                end_time: "17:00",
                availability: {
                    friday: [{ start: "09:00", end: "10:00" }],
                    monday: [{ start: "08:30", end: "11:00" }], // ğŸ¯ This is the critical slot!
                    thursday: [
                        { start: "09:00", end: "10:00" },
                        { start: "10:00", end: "11:00" },
                        { start: "11:00", end: "12:00" },
                        { start: "12:00", end: "13:00" }
                    ],
                    tuesday: [
                        { start: "09:00", end: "10:00" },
                        { start: "10:00", end: "11:00" },
                        { start: "11:00", end: "12:00" },
                        { start: "12:00", end: "13:00" }
                    ]
                }
            },
            {
                id: 4,
                username: "testuser",
                start_time: "09:00",
                end_time: "18:00",
                availability: {}
            }
        ];

        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
        document.getElementById('test-data').textContent = JSON.stringify(testUsers, null, 2);

        console.log('ğŸš€ Starting timeline test...');

        // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºã‚’å®Ÿè¡Œ
        const timeline = new ScheduleTimeline('timeline-container');
        timeline.loadData(testUsers);

        // æ¤œè¨¼ã‚’å®Ÿè¡Œ
        setTimeout(() => {
            verifyKenBlock();
        }, 1000);

        function verifyKenBlock() {
            console.log('ğŸ” Verifying ken\'s 08:30-09:00 block...');

            const results = [];

            // 1. DOMè¦ç´ ã®å­˜åœ¨ç¢ºèª
            const timelineSlots = document.querySelectorAll('.timeline-slot');
            results.push(`âœ… Timeline slots found: ${timelineSlots.length}`);

            // 2. 08:30-09:00ã‚¹ãƒ­ãƒƒãƒˆã®æ¤œç´¢
            let found0830Block = false;
            let kenBlock = null;

            timelineSlots.forEach((slot, index) => {
                const timeText = slot.querySelector('.slot-time strong');
                const participantsText = slot.querySelector('.slot-participants');

                if (timeText && timeText.textContent.includes('08:30 - 09:00')) {
                    found0830Block = true;
                    kenBlock = slot;

                    results.push(`âœ… Found 08:30-09:00 slot at index ${index}`);
                    results.push(`ğŸ“‹ Content: ${timeText.textContent}`);
                    results.push(`ğŸ‘¥ Participants: ${participantsText ? participantsText.textContent : 'N/A'}`);

                    // kenãŒå‚åŠ è€…ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                    if (participantsText && participantsText.textContent.includes('ken')) {
                        results.push(`âœ… SUCCESS: ken is included in 08:30-09:00 slot!`);

                        // è¦–è¦šçš„ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                        slot.style.border = '3px solid #FF6B6B';
                        slot.style.backgroundColor = '#FFE6E6';

                        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
                        const successBadge = document.createElement('div');
                        successBadge.innerHTML = 'ğŸ‰ <strong>FIXED!</strong> ken\'s 08:30 block found!';
                        successBadge.style.cssText = `
                            background: #4CAF50;
                            color: white;
                            padding: 8px;
                            border-radius: 4px;
                            margin-top: 8px;
                            text-align: center;
                            font-weight: bold;
                        `;
                        slot.appendChild(successBadge);
                    } else {
                        results.push(`âŒ ERROR: ken is NOT included in 08:30-09:00 slot`);
                    }
                }
            });

            // 3. Mondayæ›œæ—¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç¢ºèª
            const mondaySection = Array.from(document.querySelectorAll('.day-title')).find(
                title => title.textContent.includes('æœˆæ›œæ—¥')
            );

            if (mondaySection) {
                results.push(`âœ… Monday section found`);
            } else {
                results.push(`âŒ Monday section NOT found`);
            }

            // 4. å…¨ä½“ã®æ¤œè¨¼çµæœ
            if (found0830Block) {
                results.push(`\nğŸ¯ FINAL RESULT: âœ… SUCCESS - ken's 08:30-09:00 block is displayed!`);
                results.push(`âœ… Timeline display system works correctly`);
                results.push(`âœ… Time offset bug is FIXED`);

                document.getElementById('verification-results').className = 'test-section success';
            } else {
                results.push(`\nğŸ¯ FINAL RESULT: âŒ FAILURE - ken's 08:30-09:00 block is missing`);
                document.getElementById('verification-results').className = 'test-section error';
            }

            // çµæœã‚’è¡¨ç¤º
            document.getElementById('verification-results').innerHTML = `
                <h3>${found0830Block ? 'âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ' : 'âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—'}</h3>
                <pre>${results.join('\n')}</pre>
            `;

            console.log('ğŸ” Verification completed:', results);
        }
    </script>
</body>
</html>